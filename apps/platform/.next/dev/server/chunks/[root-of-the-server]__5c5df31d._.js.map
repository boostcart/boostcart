{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/bobkata/Projects/boostcart/apps/platform/src/proxy.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\";\n\n/**\n * Proxy for multi-tenant routing (formerly middleware)\n *\n * As of Next.js 16, middleware has been renamed to proxy.\n * The proxy runs before routes are rendered and handles:\n * - Multi-tenant subdomain routing\n * - Custom domain routing\n * - Setting tenant context headers\n *\n * Routes:\n * - boostcart.bg/* - Main marketing site & platform admin\n * - store.boostcart.bg/* - Tenant storefront\n * - custom.domain.com/* - Tenant storefront (custom domain)\n */\nexport function proxy(request: NextRequest) {\n\tconst hostname = request.headers.get(\"host\");\n\tconst pathname = request.nextUrl.pathname;\n\n\t// Skip static files and API routes\n\tif (\n\t\tpathname.startsWith(\"/_next\") ||\n\t\tpathname.startsWith(\"/api/\") ||\n\t\tpathname.includes(\".\") // Static files\n\t) {\n\t\treturn NextResponse.next();\n\t}\n\n\t// Platform domains - no tenant context needed\n\tconst platformDomains = [\n\t\t\"boostcart.bg\",\n\t\t\"www.boostcart.bg\",\n\t\t\"localhost:3000\",\n\t];\n\tif (hostname && platformDomains.includes(hostname)) {\n\t\treturn NextResponse.next();\n\t}\n\n\t// Extract tenant slug from subdomain\n\tlet tenantSlug: string | null = null;\n\n\tif (hostname) {\n\t\t// Check for subdomain pattern (e.g., store.boostcart.bg)\n\t\tconst subdomainMatch = hostname.match(/^([a-z0-9-]+)\\.boostcart\\.bg$/i);\n\t\tif (subdomainMatch?.[1]) {\n\t\t\tconst slug = subdomainMatch[1];\n\t\t\t// Skip reserved subdomains\n\t\t\tif (![\"www\", \"api\", \"admin\", \"staging\", \"dev\", \"app\"].includes(slug)) {\n\t\t\t\ttenantSlug = slug;\n\t\t\t}\n\t\t}\n\n\t\t// Check for local development subdomain (e.g., store.localhost:3000)\n\t\tconst localMatch = hostname.match(/^([a-z0-9-]+)\\.localhost/i);\n\t\tif (localMatch?.[1]) {\n\t\t\ttenantSlug = localMatch[1];\n\t\t}\n\t}\n\n\t// Set tenant slug in header for downstream use\n\tconst response = NextResponse.next();\n\n\tif (tenantSlug) {\n\t\tresponse.headers.set(\"x-tenant-slug\", tenantSlug);\n\t}\n\n\t// For custom domains, set the hostname for lookup\n\tif (\n\t\t!tenantSlug &&\n\t\thostname &&\n\t\t!hostname.includes(\"boostcart.bg\") &&\n\t\t!hostname.includes(\"localhost\")\n\t) {\n\t\tconst customDomain = hostname.split(\":\")[0];\n\t\tif (customDomain) {\n\t\t\tresponse.headers.set(\"x-custom-domain\", customDomain);\n\t\t}\n\t}\n\n\treturn response;\n}\n\nexport const config = {\n\tmatcher: [\n\t\t/*\n\t\t * Match all request paths except:\n\t\t * - _next/static (static files)\n\t\t * - _next/image (image optimization files)\n\t\t * - favicon.ico (favicon file)\n\t\t * - public files (public folder)\n\t\t */\n\t\t\"/((?!_next/static|_next/image|favicon.ico|.*\\\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)\",\n\t],\n};\n"],"names":[],"mappings":";;;;;;AAAA;;AAgBO,SAAS,MAAM,OAAoB;IACzC,MAAM,WAAW,QAAQ,OAAO,CAAC,GAAG,CAAC;IACrC,MAAM,WAAW,QAAQ,OAAO,CAAC,QAAQ;IAEzC,mCAAmC;IACnC,IACC,SAAS,UAAU,CAAC,aACpB,SAAS,UAAU,CAAC,YACpB,SAAS,QAAQ,CAAC,KAAK,eAAe;MACrC;QACD,OAAO,8IAAY,CAAC,IAAI;IACzB;IAEA,8CAA8C;IAC9C,MAAM,kBAAkB;QACvB;QACA;QACA;KACA;IACD,IAAI,YAAY,gBAAgB,QAAQ,CAAC,WAAW;QACnD,OAAO,8IAAY,CAAC,IAAI;IACzB;IAEA,qCAAqC;IACrC,IAAI,aAA4B;IAEhC,IAAI,UAAU;QACb,yDAAyD;QACzD,MAAM,iBAAiB,SAAS,KAAK,CAAC;QACtC,IAAI,gBAAgB,CAAC,EAAE,EAAE;YACxB,MAAM,OAAO,cAAc,CAAC,EAAE;YAC9B,2BAA2B;YAC3B,IAAI,CAAC;gBAAC;gBAAO;gBAAO;gBAAS;gBAAW;gBAAO;aAAM,CAAC,QAAQ,CAAC,OAAO;gBACrE,aAAa;YACd;QACD;QAEA,qEAAqE;QACrE,MAAM,aAAa,SAAS,KAAK,CAAC;QAClC,IAAI,YAAY,CAAC,EAAE,EAAE;YACpB,aAAa,UAAU,CAAC,EAAE;QAC3B;IACD;IAEA,+CAA+C;IAC/C,MAAM,WAAW,8IAAY,CAAC,IAAI;IAElC,IAAI,YAAY;QACf,SAAS,OAAO,CAAC,GAAG,CAAC,iBAAiB;IACvC;IAEA,kDAAkD;IAClD,IACC,CAAC,cACD,YACA,CAAC,SAAS,QAAQ,CAAC,mBACnB,CAAC,SAAS,QAAQ,CAAC,cAClB;QACD,MAAM,eAAe,SAAS,KAAK,CAAC,IAAI,CAAC,EAAE;QAC3C,IAAI,cAAc;YACjB,SAAS,OAAO,CAAC,GAAG,CAAC,mBAAmB;QACzC;IACD;IAEA,OAAO;AACR;AAEO,MAAM,SAAS;IACrB,SAAS;QACR;;;;;;GAMC,GACD;KACA;AACF"}}]
}