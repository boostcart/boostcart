{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":["file:///Users/bobkata/Projects/boostcart/apps/platform/src/server/api/platform/actions.ts"],"sourcesContent":["\"use server\";\n\nimport { auth } from \"@/server/auth\";\nimport { db } from \"@/server/db\";\n\n// Helper to check if user is platform admin\nasync function requirePlatformAdmin() {\n\tconst session = await auth();\n\n\tif (!session?.user) {\n\t\tthrow new Error(\"Unauthorized: Not authenticated\");\n\t}\n\n\tif (session.user.role !== \"ADMIN\") {\n\t\tthrow new Error(\"Unauthorized: Platform admin access required\");\n\t}\n\n\treturn session.user;\n}\n\n// Get platform dashboard stats\nexport async function getPlatformStats() {\n\tawait requirePlatformAdmin();\n\n\tconst [\n\t\ttotalTenants,\n\t\tactiveTenants,\n\t\ttotalUsers,\n\t\ttotalProducts,\n\t\ttotalOrders,\n\t\trecentTenants,\n\t] = await Promise.all([\n\t\tdb.tenant.count(),\n\t\tdb.tenant.count({ where: { isActive: true } }),\n\t\tdb.user.count(),\n\t\tdb.product.count(),\n\t\tdb.order.count(),\n\t\tdb.tenant.findMany({\n\t\t\ttake: 5,\n\t\t\torderBy: { createdAt: \"desc\" },\n\t\t\tselect: {\n\t\t\t\tid: true,\n\t\t\t\tname: true,\n\t\t\t\tslug: true,\n\t\t\t\tisActive: true,\n\t\t\t\tcreatedAt: true,\n\t\t\t\t_count: {\n\t\t\t\t\tselect: {\n\t\t\t\t\t\tproducts: true,\n\t\t\t\t\t\torders: true,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t}),\n\t]);\n\n\t// Calculate revenue (sum of all orders)\n\tconst revenueResult = await db.order.aggregate({\n\t\t_sum: {\n\t\t\ttotalAmount: true,\n\t\t},\n\t});\n\n\treturn {\n\t\ttotalTenants,\n\t\tactiveTenants,\n\t\ttotalUsers,\n\t\ttotalProducts,\n\t\ttotalOrders,\n\t\ttotalRevenue: revenueResult._sum?.totalAmount?.toNumber() ?? 0,\n\t\trecentTenants: recentTenants.map((t) => ({\n\t\t\tid: t.id,\n\t\t\tname: t.name,\n\t\t\tslug: t.slug,\n\t\t\tisActive: t.isActive,\n\t\t\tcreatedAt: t.createdAt.toISOString(),\n\t\t\t_count: t._count,\n\t\t})),\n\t};\n}\n\n// Get all tenants with pagination and filtering\nexport async function getTenants(options?: {\n\tpage?: number;\n\tlimit?: number;\n\tsearch?: string;\n\tstatus?: string;\n}) {\n\tawait requirePlatformAdmin();\n\n\tconst page = options?.page ?? 1;\n\tconst limit = options?.limit ?? 20;\n\tconst skip = (page - 1) * limit;\n\n\tconst where: Record<string, unknown> = {};\n\n\tif (options?.search) {\n\t\twhere.OR = [\n\t\t\t{ name: { contains: options.search, mode: \"insensitive\" } },\n\t\t\t{ slug: { contains: options.search, mode: \"insensitive\" } },\n\t\t];\n\t}\n\n\tif (options?.status && options.status !== \"all\") {\n\t\t// Map status string to isActive boolean\n\t\tif (options.status === \"ACTIVE\") {\n\t\t\twhere.isActive = true;\n\t\t} else if (options.status === \"INACTIVE\" || options.status === \"SUSPENDED\") {\n\t\t\twhere.isActive = false;\n\t\t}\n\t}\n\n\tconst [tenants, total] = await Promise.all([\n\t\tdb.tenant.findMany({\n\t\t\twhere,\n\t\t\tskip,\n\t\t\ttake: limit,\n\t\t\torderBy: { createdAt: \"desc\" },\n\t\t\tinclude: {\n\t\t\t\t_count: {\n\t\t\t\t\tselect: {\n\t\t\t\t\t\tproducts: true,\n\t\t\t\t\t\torders: true,\n\t\t\t\t\t\tstaff: true,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t}),\n\t\tdb.tenant.count({ where }),\n\t]);\n\n\treturn {\n\t\ttenants: tenants.map((t) => ({\n\t\t\tid: t.id,\n\t\t\tname: t.name,\n\t\t\tslug: t.slug,\n\t\t\tisActive: t.isActive,\n\t\t\temail: t.email,\n\t\t\tcreatedAt: t.createdAt.toISOString(),\n\t\t\tupdatedAt: t.updatedAt.toISOString(),\n\t\t\tproductCount: t._count.products,\n\t\t\torderCount: t._count.orders,\n\t\t\tstaffCount: t._count.staff,\n\t\t})),\n\t\tpagination: {\n\t\t\tpage,\n\t\t\tlimit,\n\t\t\ttotal,\n\t\t\ttotalPages: Math.ceil(total / limit),\n\t\t},\n\t};\n}\n\n// Update tenant status (activate/deactivate)\nexport async function updateTenantStatus(\n\ttenantId: string,\n\tisActive: boolean,\n) {\n\tawait requirePlatformAdmin();\n\n\tconst tenant = await db.tenant.update({\n\t\twhere: { id: tenantId },\n\t\tdata: { isActive },\n\t\tselect: {\n\t\t\tid: true,\n\t\t\tname: true,\n\t\t\tisActive: true,\n\t\t},\n\t});\n\n\treturn tenant;\n}\n\n// Delete a tenant (with caution)\nexport async function deleteTenant(tenantId: string) {\n\tawait requirePlatformAdmin();\n\n\t// First check if tenant exists and get info\n\tconst tenant = await db.tenant.findUnique({\n\t\twhere: { id: tenantId },\n\t\tselect: {\n\t\t\tname: true,\n\t\t\t_count: {\n\t\t\t\tselect: {\n\t\t\t\t\torders: true,\n\t\t\t\t\tproducts: true,\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t});\n\n\tif (!tenant) {\n\t\tthrow new Error(\"Tenant not found\");\n\t}\n\n\t// Delete tenant (cascading deletes should handle related data)\n\tawait db.tenant.delete({\n\t\twhere: { id: tenantId },\n\t});\n\n\treturn { success: true, name: tenant.name };\n}\n\n// Get all platform users with pagination\nexport async function getPlatformUsers(options?: {\n\tpage?: number;\n\tlimit?: number;\n\tsearch?: string;\n\trole?: string;\n}) {\n\tawait requirePlatformAdmin();\n\n\tconst page = options?.page ?? 1;\n\tconst limit = options?.limit ?? 20;\n\tconst skip = (page - 1) * limit;\n\n\tconst where: Record<string, unknown> = {};\n\n\tif (options?.search) {\n\t\twhere.OR = [\n\t\t\t{ name: { contains: options.search, mode: \"insensitive\" } },\n\t\t\t{ email: { contains: options.search, mode: \"insensitive\" } },\n\t\t];\n\t}\n\n\tif (options?.role && options.role !== \"all\") {\n\t\twhere.role = options.role;\n\t}\n\n\tconst [users, total] = await Promise.all([\n\t\tdb.user.findMany({\n\t\t\twhere,\n\t\t\tskip,\n\t\t\ttake: limit,\n\t\t\torderBy: { createdAt: \"desc\" },\n\t\t\tselect: {\n\t\t\t\tid: true,\n\t\t\t\tname: true,\n\t\t\t\temail: true,\n\t\t\t\temailVerified: true,\n\t\t\t\timage: true,\n\t\t\t\trole: true,\n\t\t\t\tcreatedAt: true,\n\t\t\t\tupdatedAt: true,\n\t\t\t},\n\t\t}),\n\t\tdb.user.count({ where }),\n\t]);\n\n\treturn {\n\t\tusers: users.map((u) => ({\n\t\t\t...u,\n\t\t\tcreatedAt: u.createdAt.toISOString(),\n\t\t\tupdatedAt: u.updatedAt.toISOString(),\n\t\t})),\n\t\tpagination: {\n\t\t\tpage,\n\t\t\tlimit,\n\t\t\ttotal,\n\t\t\ttotalPages: Math.ceil(total / limit),\n\t\t},\n\t};\n}\n\n// Update user role\nexport async function updateUserRole(userId: string, role: \"USER\" | \"ADMIN\") {\n\tconst admin = await requirePlatformAdmin();\n\n\t// Prevent removing own admin role\n\tif (userId === admin.id && role !== \"ADMIN\") {\n\t\tthrow new Error(\"Cannot remove your own admin role\");\n\t}\n\n\tconst user = await db.user.update({\n\t\twhere: { id: userId },\n\t\tdata: { role },\n\t\tselect: {\n\t\t\tid: true,\n\t\t\tname: true,\n\t\t\temail: true,\n\t\t\trole: true,\n\t\t},\n\t});\n\n\treturn user;\n}\n\n// Delete a user\nexport async function deleteUser(userId: string) {\n\tconst admin = await requirePlatformAdmin();\n\n\t// Prevent self-deletion\n\tif (userId === admin.id) {\n\t\tthrow new Error(\"Cannot delete your own account\");\n\t}\n\n\tconst user = await db.user.findUnique({\n\t\twhere: { id: userId },\n\t\tselect: { name: true, email: true },\n\t});\n\n\tif (!user) {\n\t\tthrow new Error(\"User not found\");\n\t}\n\n\tawait db.user.delete({\n\t\twhere: { id: userId },\n\t});\n\n\treturn { success: true, name: user.name, email: user.email };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 358, "column": 0}, "map": {"version":3,"sources":["file:///Users/bobkata/Projects/boostcart/apps/platform/.next-internal/server/app/%28internal%29/platform-admin/users/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {getUserStores as '003bfcd7ac293af20dc22123ec44e81263e2c95347'} from 'ACTIONS_MODULE0'\nexport {userHasStore as '00b865bde8853c0b2200356e8a44aabbfda99ded8f'} from 'ACTIONS_MODULE0'\nexport {getCurrentTenant as '00f61908051b9076d3d4981917b5b0f4b9a64a3f03'} from 'ACTIONS_MODULE0'\nexport {createStore as '40177cd97a285945b21e6d3751ddbdc14238608821'} from 'ACTIONS_MODULE0'\nexport {checkSlugAvailability as '40ece7c8b327f75aed046925634f22b2bd96f4eb54'} from 'ACTIONS_MODULE0'\nexport {deleteUser as '40eea079f5e3dcd9be37481548c4733725c80a9e60'} from 'ACTIONS_MODULE1'\nexport {getPlatformUsers as '40e0dcea7e68e9d5c2969f8b90d0388b8ac43bf623'} from 'ACTIONS_MODULE1'\nexport {updateUserRole as '60cd19758d90e5fcbefb5e9c7fa842c2ef725a424b'} from 'ACTIONS_MODULE1'\n"],"names":[],"mappings":";AAAA;AAKA"}}]
}