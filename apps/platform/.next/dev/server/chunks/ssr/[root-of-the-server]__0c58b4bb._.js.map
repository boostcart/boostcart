{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/bobkata/Projects/boostcart/apps/platform/src/schemas/product.ts"],"sourcesContent":["import { z } from \"zod\";\n\n// Enums matching Prisma schema\nexport const ProductStatusEnum = z.enum([\"ACTIVE\", \"UNLISTED\", \"DRAFT\"]);\nexport const MediaTypeEnum = z.enum([\"IMAGE\", \"VIDEO\"]);\nexport const PurchaseTypeEnum = z.enum([\n\t\"ONE_TIME\",\n\t\"SUBSCRIPTION\",\n\t\"ONE_TIME_AND_SUBSCRIPTION\",\n\t\"PRE_ORDER\",\n]);\nexport const SubscriptionIntervalEnum = z.enum([\n\t\"WEEKLY\",\n\t\"BI_WEEKLY\",\n\t\"MONTHLY\",\n\t\"BI_MONTHLY\",\n\t\"QUARTERLY\",\n\t\"YEARLY\",\n]);\nexport const PackageTypeEnum = z.enum([\n\t\"BOX\",\n\t\"ENVELOPE\",\n\t\"SOFT_PACKAGE\",\n\t\"PALLET\",\n]);\nexport const MeasurementUnitEnum = z.enum([\n\t\"KG\",\n\t\"G\",\n\t\"L\",\n\t\"ML\",\n\t\"M\",\n\t\"CM\",\n\t\"MM\",\n\t\"SQM\",\n\t\"SQCM\",\n\t\"PER_ITEM\",\n]);\n\n// Types\nexport type ProductStatus = z.infer<typeof ProductStatusEnum>;\nexport type MediaType = z.infer<typeof MediaTypeEnum>;\nexport type PurchaseType = z.infer<typeof PurchaseTypeEnum>;\nexport type SubscriptionInterval = z.infer<typeof SubscriptionIntervalEnum>;\nexport type PackageType = z.infer<typeof PackageTypeEnum>;\nexport type MeasurementUnit = z.infer<typeof MeasurementUnitEnum>;\n\n// Product Media Schema\nexport const ProductMediaSchema = z.object({\n\tid: z.string().optional(),\n\turl: z.string().url(),\n\tmediaType: MediaTypeEnum,\n\taltText: z.string().optional(),\n\torder: z.number().int().min(0),\n});\nexport type ProductMediaInput = z.infer<typeof ProductMediaSchema>;\n\n// Variant Option Meta (for color picker etc)\nexport const VariantOptionMetaSchema = z.object({\n\toptionName: z.string(),\n\thexColor: z\n\t\t.string()\n\t\t.regex(/^#[0-9A-Fa-f]{6}$/)\n\t\t.optional(),\n});\nexport type VariantOptionMeta = z.infer<typeof VariantOptionMetaSchema>;\n\n// Product Variant Schema\nexport const ProductVariantSchema = z.object({\n\tid: z.string().optional(),\n\tsku: z.string().optional(),\n\tprice: z.number().positive().optional(), // Override price\n\tpriceAdjustment: z.number().default(0),\n\tstock: z.number().int().min(0).optional(),\n\timageUrl: z.string().url().optional(),\n\toptions: z.record(z.string(), z.string()).default({}), // { \"Color\": \"Red\", \"Size\": \"Large\" }\n\toptionMeta: z.array(VariantOptionMetaSchema).optional(),\n});\nexport type ProductVariantInput = z.infer<typeof ProductVariantSchema>;\n\n// Product Shipping Schema\nexport const ProductShippingSchema = z.object({\n\tpackageType: PackageTypeEnum.default(\"BOX\"),\n\t// Packaging weight\n\tweight: z.number().positive().optional(),\n\t// Package dimensions\n\tpackageLength: z.number().positive().optional(),\n\tpackageWidth: z.number().positive().optional(),\n\tpackageHeight: z.number().positive().optional(),\n\t// Product weight\n\tproductWeight: z.number().positive().optional(),\n\t// Product dimensions (for pallets)\n\tproductLength: z.number().positive().optional(),\n\tproductWidth: z.number().positive().optional(),\n\tproductHeight: z.number().positive().optional(),\n\t// Flags\n\tisFragile: z.boolean().default(false),\n\tisFreeShipping: z.boolean().default(false),\n\ttags: z.array(z.string()).default([]),\n});\nexport type ProductShippingInput = z.infer<typeof ProductShippingSchema>;\n\n// Product SEO Schema\nexport const ProductSeoSchema = z.object({\n\tmetaTitle: z.string().max(70).optional(),\n\tmetaDescription: z.string().max(160).optional(),\n\tslug: z\n\t\t.string()\n\t\t.regex(/^[a-z0-9]+(?:-[a-z0-9]+)*$/)\n\t\t.optional(),\n});\nexport type ProductSeoInput = z.infer<typeof ProductSeoSchema>;\n\n// Product Purchase Options Schema\nexport const ProductPurchaseOptionsSchema = z.object({\n\ttype: PurchaseTypeEnum.default(\"ONE_TIME\"),\n\tallowOneTimePurchase: z.boolean().default(true),\n\tsubscriptionDiscount: z.number().min(0).max(100).optional(),\n\tsubscriptionIntervals: z.array(SubscriptionIntervalEnum).optional(),\n\tpreOrderReleaseDate: z.coerce.date().optional(),\n\tpreOrderDepositPercent: z.number().min(0).max(100).optional(),\n});\nexport type ProductPurchaseOptionsInput = z.infer<\n\ttypeof ProductPurchaseOptionsSchema\n>;\n\n// Unit Price Schema\nexport const ProductUnitPriceSchema = z.object({\n\tunitPriceAmount: z.number().positive().optional(),\n\tunitPriceMeasurement: MeasurementUnitEnum.optional(),\n\tunitPriceBaseAmount: z.number().positive().optional(),\n\tunitPriceBaseMeasurement: MeasurementUnitEnum.optional(),\n});\nexport type ProductUnitPriceInput = z.infer<typeof ProductUnitPriceSchema>;\n\n// Full Create Product Schema\nexport const CreateProductSchema = z.object({\n\t// Basic info\n\tname: z.string().min(1, \"Name is required\").max(255),\n\tdescription: z.string().optional(),\n\tslug: z.string().regex(/^[a-z0-9]+(?:-[a-z0-9]+)*$/, \"Invalid URL format\"),\n\tstatus: ProductStatusEnum.default(\"DRAFT\"),\n\n\t// Categorization\n\tcategoryId: z.string().min(1, \"Category is required\"),\n\tbrandId: z.string().optional(),\n\tcollectionIds: z.array(z.string()).optional(),\n\n\t// Pricing\n\tprice: z.number().positive(\"Price must be greater than 0\"),\n\tcompareAtPrice: z.number().positive().optional(),\n\tcostPerItem: z.number().positive().optional(),\n\tunitPrice: ProductUnitPriceSchema.optional(),\n\n\t// Inventory\n\tsku: z.string().optional(),\n\ttrackStock: z.boolean().default(false),\n\tstock: z.number().int().min(0).optional(),\n\tlowStockThreshold: z.number().int().min(0).optional(),\n\n\t// Media\n\tmedia: z.array(ProductMediaSchema).optional(),\n\n\t// Variants\n\tvariants: z.array(ProductVariantSchema).optional(),\n\n\t// Shipping\n\tshippingInfo: ProductShippingSchema.optional(),\n\n\t// Purchase options\n\tpurchaseOptions: ProductPurchaseOptionsSchema.optional(),\n\n\t// SEO\n\tseo: ProductSeoSchema.optional(),\n});\n\nexport type CreateProductInput = z.infer<typeof CreateProductSchema>;\n\n// Update Product Schema (all fields optional)\nexport const UpdateProductSchema = CreateProductSchema.partial().extend({\n\tid: z.string(),\n});\nexport type UpdateProductInput = z.infer<typeof UpdateProductSchema>;\n\n// Variant Group Schema (for form state)\nexport const VariantGroupSchema = z.object({\n\tname: z.string().min(1, \"Variant name is required\"),\n\tvalues: z\n\t\t.array(\n\t\t\tz.object({\n\t\t\t\tvalue: z.string().min(1),\n\t\t\t\thexColor: z\n\t\t\t\t\t.string()\n\t\t\t\t\t.regex(/^#[0-9A-Fa-f]{6}$/)\n\t\t\t\t\t.optional(),\n\t\t\t}),\n\t\t)\n\t\t.min(1, \"At least one value is required\"),\n});\nexport type VariantGroupInput = z.infer<typeof VariantGroupSchema>;\n\n// Product filter schema for list page\nexport const ProductFilterSchema = z.object({\n\tsearch: z.string().optional(),\n\tstatus: z.array(ProductStatusEnum).optional(),\n\tcategoryIds: z.array(z.string()).optional(),\n\tbrandIds: z.array(z.string()).optional(),\n\tstockStatus: z\n\t\t.enum([\"all\", \"in_stock\", \"low_stock\", \"out_of_stock\"])\n\t\t.optional(),\n\tpriceMin: z.number().min(0).optional(),\n\tpriceMax: z.number().min(0).optional(),\n\tpurchaseType: z.array(PurchaseTypeEnum).optional(),\n\tsortBy: z\n\t\t.enum([\n\t\t\t\"name_asc\",\n\t\t\t\"name_desc\",\n\t\t\t\"price_asc\",\n\t\t\t\"price_desc\",\n\t\t\t\"created_asc\",\n\t\t\t\"created_desc\",\n\t\t\t\"stock_asc\",\n\t\t\t\"stock_desc\",\n\t\t])\n\t\t.optional(),\n\tpage: z.number().int().min(1).default(1),\n\tpageSize: z.number().int().min(1).max(100).default(20),\n});\nexport type ProductFilterInput = z.infer<typeof ProductFilterSchema>;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 238, "column": 0}, "map": {"version":3,"sources":["file:///Users/bobkata/Projects/boostcart/packages/storage/src/utils.ts"],"sourcesContent":["import { randomUUID } from \"crypto\";\n\n/**\n * File type categories\n */\nexport type FileType = \"image\" | \"video\" | \"document\" | \"other\";\n\n/**\n * Common MIME types mapping\n */\nconst MIME_TYPES: Record<string, string> = {\n  // Images\n  jpg: \"image/jpeg\",\n  jpeg: \"image/jpeg\",\n  png: \"image/png\",\n  gif: \"image/gif\",\n  webp: \"image/webp\",\n  svg: \"image/svg+xml\",\n  avif: \"image/avif\",\n  // Videos\n  mp4: \"video/mp4\",\n  webm: \"video/webm\",\n  mov: \"video/quicktime\",\n  avi: \"video/x-msvideo\",\n  // Documents\n  pdf: \"application/pdf\",\n  doc: \"application/msword\",\n  docx: \"application/vnd.openxmlformats-officedocument.wordprocessingml.document\",\n  xls: \"application/vnd.ms-excel\",\n  xlsx: \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\",\n  csv: \"text/csv\",\n  txt: \"text/plain\",\n  json: \"application/json\",\n};\n\n/**\n * Generate a unique upload key for R2\n * Format: {tenantId}/{folder}/{uuid}.{ext}\n */\nexport function generateUploadKey(\n  tenantId: string,\n  originalFilename: string,\n  folder?: string | null\n): string {\n  const ext = getFileExtension(originalFilename);\n  const uuid = randomUUID();\n  const filename = `${uuid}${ext ? `.${ext}` : \"\"}`;\n\n  if (folder) {\n    return `${tenantId}/${folder}/${filename}`;\n  }\n  return `${tenantId}/${filename}`;\n}\n\n/**\n * Get file extension from filename\n */\nexport function getFileExtension(filename: string): string {\n  const parts = filename.split(\".\");\n  if (parts.length < 2) return \"\";\n  return parts.pop()?.toLowerCase() ?? \"\";\n}\n\n/**\n * Get MIME type from filename\n */\nexport function getMimeType(filename: string): string {\n  const ext = getFileExtension(filename);\n  return MIME_TYPES[ext] ?? \"application/octet-stream\";\n}\n\n/**\n * Check if file is an image\n */\nexport function isImageFile(mimeType: string): boolean {\n  return mimeType.startsWith(\"image/\");\n}\n\n/**\n * Check if file is a video\n */\nexport function isVideoFile(mimeType: string): boolean {\n  return mimeType.startsWith(\"video/\");\n}\n\n/**\n * Check if file is a document\n */\nexport function isDocumentFile(mimeType: string): boolean {\n  return (\n    mimeType.includes(\"pdf\") ||\n    mimeType.includes(\"document\") ||\n    mimeType.includes(\"spreadsheet\") ||\n    mimeType.includes(\"text/\")\n  );\n}\n\n/**\n * Get file type category\n */\nexport function getFileType(mimeType: string): FileType {\n  if (isImageFile(mimeType)) return \"image\";\n  if (isVideoFile(mimeType)) return \"video\";\n  if (isDocumentFile(mimeType)) return \"document\";\n  return \"other\";\n}\n\n/**\n * Format file size for display\n */\nexport function formatFileSize(bytes: number): string {\n  if (bytes === 0) return \"0 B\";\n  const k = 1024;\n  const sizes = [\"B\", \"KB\", \"MB\", \"GB\"];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  return `${parseFloat((bytes / Math.pow(k, i)).toFixed(1))} ${sizes[i]}`;\n}\n\n/**\n * Validate file size\n */\nexport function validateFileSize(\n  bytes: number,\n  maxSizeMB: number = 10\n): boolean {\n  return bytes <= maxSizeMB * 1024 * 1024;\n}\n\n/**\n * Allowed file types for upload\n */\nexport const ALLOWED_IMAGE_TYPES = [\n  \"image/jpeg\",\n  \"image/png\",\n  \"image/gif\",\n  \"image/webp\",\n  \"image/svg+xml\",\n  \"image/avif\",\n];\n\nexport const ALLOWED_VIDEO_TYPES = [\n  \"video/mp4\",\n  \"video/webm\",\n  \"video/quicktime\",\n];\n\nexport const ALLOWED_DOCUMENT_TYPES = [\n  \"application/pdf\",\n  \"application/msword\",\n  \"application/vnd.openxmlformats-officedocument.wordprocessingml.document\",\n  \"application/vnd.ms-excel\",\n  \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\",\n  \"text/csv\",\n  \"text/plain\",\n];\n\nexport const ALLOWED_FILE_TYPES = [\n  ...ALLOWED_IMAGE_TYPES,\n  ...ALLOWED_VIDEO_TYPES,\n  ...ALLOWED_DOCUMENT_TYPES,\n];\n\n/**\n * Validate file type\n */\nexport function validateFileType(\n  mimeType: string,\n  allowedTypes: string[] = ALLOWED_FILE_TYPES\n): boolean {\n  return allowedTypes.includes(mimeType);\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AAOA;;CAEC,GACD,MAAM,aAAqC;IACzC,SAAS;IACT,KAAK;IACL,MAAM;IACN,KAAK;IACL,KAAK;IACL,MAAM;IACN,KAAK;IACL,MAAM;IACN,SAAS;IACT,KAAK;IACL,MAAM;IACN,KAAK;IACL,KAAK;IACL,YAAY;IACZ,KAAK;IACL,KAAK;IACL,MAAM;IACN,KAAK;IACL,MAAM;IACN,KAAK;IACL,KAAK;IACL,MAAM;AACR;AAMO,SAAS,kBACd,QAAgB,EAChB,gBAAwB,EACxB,MAAsB;IAEtB,MAAM,MAAM,iBAAiB;IAC7B,MAAM,OAAO,IAAA,mHAAU;IACvB,MAAM,WAAW,GAAG,OAAO,MAAM,CAAC,CAAC,EAAE,KAAK,GAAG,IAAI;IAEjD,IAAI,QAAQ;QACV,OAAO,GAAG,SAAS,CAAC,EAAE,OAAO,CAAC,EAAE,UAAU;IAC5C;IACA,OAAO,GAAG,SAAS,CAAC,EAAE,UAAU;AAClC;AAKO,SAAS,iBAAiB,QAAgB;IAC/C,MAAM,QAAQ,SAAS,KAAK,CAAC;IAC7B,IAAI,MAAM,MAAM,GAAG,GAAG,OAAO;IAC7B,OAAO,MAAM,GAAG,IAAI,iBAAiB;AACvC;AAKO,SAAS,YAAY,QAAgB;IAC1C,MAAM,MAAM,iBAAiB;IAC7B,OAAO,UAAU,CAAC,IAAI,IAAI;AAC5B;AAKO,SAAS,YAAY,QAAgB;IAC1C,OAAO,SAAS,UAAU,CAAC;AAC7B;AAKO,SAAS,YAAY,QAAgB;IAC1C,OAAO,SAAS,UAAU,CAAC;AAC7B;AAKO,SAAS,eAAe,QAAgB;IAC7C,OACE,SAAS,QAAQ,CAAC,UAClB,SAAS,QAAQ,CAAC,eAClB,SAAS,QAAQ,CAAC,kBAClB,SAAS,QAAQ,CAAC;AAEtB;AAKO,SAAS,YAAY,QAAgB;IAC1C,IAAI,YAAY,WAAW,OAAO;IAClC,IAAI,YAAY,WAAW,OAAO;IAClC,IAAI,eAAe,WAAW,OAAO;IACrC,OAAO;AACT;AAKO,SAAS,eAAe,KAAa;IAC1C,IAAI,UAAU,GAAG,OAAO;IACxB,MAAM,IAAI;IACV,MAAM,QAAQ;QAAC;QAAK;QAAM;QAAM;KAAK;IACrC,MAAM,IAAI,KAAK,KAAK,CAAC,KAAK,GAAG,CAAC,SAAS,KAAK,GAAG,CAAC;IAChD,OAAO,GAAG,WAAW,CAAC,QAAQ,KAAK,GAAG,CAAC,GAAG,EAAE,EAAE,OAAO,CAAC,IAAI,CAAC,EAAE,KAAK,CAAC,EAAE,EAAE;AACzE;AAKO,SAAS,iBACd,KAAa,EACb,YAAoB,EAAE;IAEtB,OAAO,SAAS,YAAY,OAAO;AACrC;AAKO,MAAM,sBAAsB;IACjC;IACA;IACA;IACA;IACA;IACA;CACD;AAEM,MAAM,sBAAsB;IACjC;IACA;IACA;CACD;AAEM,MAAM,yBAAyB;IACpC;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AAEM,MAAM,qBAAqB;OAC7B;OACA;OACA;CACJ;AAKM,SAAS,iBACd,QAAgB,EAChB,eAAyB,kBAAkB;IAE3C,OAAO,aAAa,QAAQ,CAAC;AAC/B"}},
    {"offset": {"line": 378, "column": 0}, "map": {"version":3,"sources":["file:///Users/bobkata/Projects/boostcart/packages/storage/src/r2.ts"],"sourcesContent":["import {\n  S3Client,\n  PutObjectCommand,\n  DeleteObjectCommand,\n  GetObjectCommand,\n  HeadObjectCommand,\n  ListObjectsV2Command,\n  type PutObjectCommandInput,\n} from \"@aws-sdk/client-s3\";\nimport { getSignedUrl } from \"@aws-sdk/s3-request-presigner\";\nimport { generateUploadKey, getMimeType } from \"./utils\";\n\nexport interface R2Config {\n  accountId: string;\n  accessKeyId: string;\n  secretAccessKey: string;\n  bucketName: string;\n  endpoint?: string; // Optional: full endpoint URL for regional buckets\n  publicUrl?: string; // Custom domain or R2 public URL\n}\n\nexport interface UploadOptions {\n  tenantId: string;\n  filename: string;\n  contentType?: string;\n  folder?: string | null;\n  metadata?: Record<string, string>;\n}\n\nexport interface UploadResult {\n  key: string;\n  url: string;\n  filename: string;\n  size: number;\n  contentType: string;\n}\n\nexport interface PresignedUploadResult {\n  uploadUrl: string;\n  key: string;\n  publicUrl: string;\n}\n\n/**\n * Cloudflare R2 Storage Client\n * Uses S3-compatible API\n */\nexport class R2Client {\n  private client: S3Client;\n  private bucketName: string;\n  private publicUrl: string;\n\n  constructor(config: R2Config) {\n    // Support custom endpoint (for regional buckets) or construct default\n    const endpoint =\n      config.endpoint ?? `https://${config.accountId}.r2.cloudflarestorage.com`;\n\n    this.client = new S3Client({\n      region: \"auto\",\n      endpoint,\n      credentials: {\n        accessKeyId: config.accessKeyId,\n        secretAccessKey: config.secretAccessKey,\n      },\n    });\n    this.bucketName = config.bucketName;\n    // Use custom domain or construct R2 public URL\n    this.publicUrl =\n      config.publicUrl ??\n      `https://${config.bucketName}.${config.accountId}.r2.cloudflarestorage.com`;\n  }\n\n  /**\n   * Upload a file directly to R2\n   */\n  async upload(\n    file: Buffer | Uint8Array | ReadableStream,\n    options: UploadOptions\n  ): Promise<UploadResult> {\n    const key = generateUploadKey(\n      options.tenantId,\n      options.filename,\n      options.folder\n    );\n    const contentType = options.contentType ?? getMimeType(options.filename);\n\n    const params: PutObjectCommandInput = {\n      Bucket: this.bucketName,\n      Key: key,\n      Body: file,\n      ContentType: contentType,\n      Metadata: {\n        ...options.metadata,\n        tenantId: options.tenantId,\n        originalFilename: options.filename,\n      },\n    };\n\n    await this.client.send(new PutObjectCommand(params));\n\n    // Get file size\n    const headResponse = await this.client.send(\n      new HeadObjectCommand({\n        Bucket: this.bucketName,\n        Key: key,\n      })\n    );\n\n    return {\n      key,\n      url: this.getPublicUrl(key),\n      filename: options.filename,\n      size: headResponse.ContentLength ?? 0,\n      contentType,\n    };\n  }\n\n  /**\n   * Generate a presigned URL for client-side uploads\n   * This allows direct upload to R2 without going through the server\n   */\n  async getPresignedUploadUrl(\n    options: UploadOptions,\n    expiresIn: number = 3600 // 1 hour\n  ): Promise<PresignedUploadResult> {\n    const key = generateUploadKey(\n      options.tenantId,\n      options.filename,\n      options.folder\n    );\n    const contentType = options.contentType ?? getMimeType(options.filename);\n\n    const command = new PutObjectCommand({\n      Bucket: this.bucketName,\n      Key: key,\n      ContentType: contentType,\n      Metadata: {\n        tenantId: options.tenantId,\n        originalFilename: options.filename,\n      },\n    });\n\n    const uploadUrl = await getSignedUrl(this.client, command, { expiresIn });\n\n    return {\n      uploadUrl,\n      key,\n      publicUrl: this.getPublicUrl(key),\n    };\n  }\n\n  /**\n   * Get a presigned URL for downloading/viewing a private file\n   */\n  async getPresignedDownloadUrl(\n    key: string,\n    expiresIn: number = 3600\n  ): Promise<string> {\n    const command = new GetObjectCommand({\n      Bucket: this.bucketName,\n      Key: key,\n    });\n\n    return getSignedUrl(this.client, command, { expiresIn });\n  }\n\n  /**\n   * Delete a file from R2\n   */\n  async delete(key: string): Promise<void> {\n    await this.client.send(\n      new DeleteObjectCommand({\n        Bucket: this.bucketName,\n        Key: key,\n      })\n    );\n  }\n\n  /**\n   * Delete multiple files from R2\n   */\n  async deleteMany(keys: string[]): Promise<void> {\n    await Promise.all(keys.map((key) => this.delete(key)));\n  }\n\n  /**\n   * Check if a file exists\n   */\n  async exists(key: string): Promise<boolean> {\n    try {\n      await this.client.send(\n        new HeadObjectCommand({\n          Bucket: this.bucketName,\n          Key: key,\n        })\n      );\n      return true;\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * List files in a folder\n   */\n  async listFiles(\n    tenantId: string,\n    folder?: string | null,\n    maxKeys: number = 1000\n  ) {\n    const prefix = folder ? `${tenantId}/${folder}/` : `${tenantId}/`;\n\n    const response = await this.client.send(\n      new ListObjectsV2Command({\n        Bucket: this.bucketName,\n        Prefix: prefix,\n        MaxKeys: maxKeys,\n      })\n    );\n\n    return (\n      response.Contents?.map((item) => ({\n        key: item.Key!,\n        size: item.Size ?? 0,\n        lastModified: item.LastModified,\n        url: this.getPublicUrl(item.Key!),\n      })) ?? []\n    );\n  }\n\n  /**\n   * Get public URL for a file\n   */\n  getPublicUrl(key: string): string {\n    return `${this.publicUrl}/${key}`;\n  }\n\n  /**\n   * Extract key from public URL\n   */\n  getKeyFromUrl(url: string): string | null {\n    if (!url.startsWith(this.publicUrl)) return null;\n    return url.slice(this.publicUrl.length + 1);\n  }\n}\n\n/**\n * Create R2 client from environment variables\n */\nexport function createR2Client(config: R2Config): R2Client {\n  return new R2Client(config);\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 536, "column": 0}, "map": {"version":3,"sources":["file:///Users/bobkata/Projects/boostcart/packages/storage/src/folders.ts"],"sourcesContent":["/**\n * Flat folder structure for organizing media files.\n * Files are stored with paths like: /{tenantId}/{folder}/{filename}\n */\nexport const FOLDERS = {\n  ROOT: null,\n  PRODUCTS: \"products\",\n  BLOG: \"blog\",\n  PAGES: \"pages\",\n  MARKETING: \"marketing\",\n  AVATARS: \"avatars\",\n  OTHER: \"other\",\n} as const;\n\nexport type FolderType = (typeof FOLDERS)[keyof typeof FOLDERS];\n\n/**\n * Folder metadata for UI display\n */\nexport const FOLDER_META: Record<\n  Exclude<FolderType, null>,\n  { label: string; description: string }\n> = {\n  products: {\n    label: \"Products\",\n    description: \"Product images and galleries\",\n  },\n  blog: {\n    label: \"Blog\",\n    description: \"Blog post images and media\",\n  },\n  pages: {\n    label: \"Pages\",\n    description: \"Static page images\",\n  },\n  marketing: {\n    label: \"Marketing\",\n    description: \"Banners, promotional images\",\n  },\n  avatars: {\n    label: \"Avatars\",\n    description: \"User and customer avatars\",\n  },\n  other: {\n    label: \"Other\",\n    description: \"Miscellaneous files\",\n  },\n};\n\n/**\n * Get folder label for display\n */\nexport function getFolderLabel(folder: FolderType): string {\n  if (folder === null) return \"All Files\";\n  return FOLDER_META[folder]?.label ?? folder;\n}\n\n/**\n * Validate folder name\n */\nexport function isValidFolder(folder: string | null): folder is FolderType {\n  if (folder === null) return true;\n  return Object.values(FOLDERS).includes(folder as FolderType);\n}\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;;;;;;;AACM,MAAM,UAAU;IACrB,MAAM;IACN,UAAU;IACV,MAAM;IACN,OAAO;IACP,WAAW;IACX,SAAS;IACT,OAAO;AACT;AAOO,MAAM,cAGT;IACF,UAAU;QACR,OAAO;QACP,aAAa;IACf;IACA,MAAM;QACJ,OAAO;QACP,aAAa;IACf;IACA,OAAO;QACL,OAAO;QACP,aAAa;IACf;IACA,WAAW;QACT,OAAO;QACP,aAAa;IACf;IACA,SAAS;QACP,OAAO;QACP,aAAa;IACf;IACA,OAAO;QACL,OAAO;QACP,aAAa;IACf;AACF;AAKO,SAAS,eAAe,MAAkB;IAC/C,IAAI,WAAW,MAAM,OAAO;IAC5B,OAAO,WAAW,CAAC,OAAO,EAAE,SAAS;AACvC;AAKO,SAAS,cAAc,MAAqB;IACjD,IAAI,WAAW,MAAM,OAAO;IAC5B,OAAO,OAAO,MAAM,CAAC,SAAS,QAAQ,CAAC;AACzC"}},
    {"offset": {"line": 596, "column": 0}, "map": {"version":3,"sources":["file:///Users/bobkata/Projects/boostcart/packages/storage/src/index.ts"],"sourcesContent":["export { R2Client, type R2Config, type UploadOptions, type UploadResult } from \"./r2\";\nexport {\n  generateUploadKey,\n  getFileExtension,\n  getMimeType,\n  isImageFile,\n  isVideoFile,\n  isDocumentFile,\n  getFileType,\n  formatFileSize,\n  validateFileSize,\n  validateFileType,\n  ALLOWED_FILE_TYPES,\n  ALLOWED_IMAGE_TYPES,\n  ALLOWED_VIDEO_TYPES,\n  ALLOWED_DOCUMENT_TYPES,\n  type FileType,\n} from \"./utils\";\nexport { FOLDERS, type FolderType } from \"./folders\";\n"],"names":[],"mappings":";AAAA;AACA;AAiBA"}},
    {"offset": {"line": 607, "column": 0}, "map": {"version":3,"sources":["file:///Users/bobkata/Projects/boostcart/apps/platform/src/server/storage.ts"],"sourcesContent":["import { R2Client } from \"@boostcart/storage\";\nimport { env } from \"@/env\";\n\n/**\n * R2 Storage Client Singleton\n * Used for file uploads throughout the platform\n */\nfunction createStorageClient() {\n\treturn new R2Client({\n\t\taccountId: env.R2_ACCOUNT_ID,\n\t\taccessKeyId: env.R2_ACCESS_KEY_ID,\n\t\tsecretAccessKey: env.R2_SECRET_ACCESS_KEY,\n\t\tbucketName: env.R2_BUCKET_NAME,\n\t\tendpoint: env.R2_ENDPOINT, // Optional: for regional buckets\n\t\tpublicUrl: env.R2_CUSTOM_DOMAIN, // Custom domain for public URLs\n\t});\n}\n\n// Global singleton for storage client\nconst globalForStorage = globalThis as unknown as {\n\tstorage: R2Client | undefined;\n};\n\nexport const storage = globalForStorage.storage ?? createStorageClient();\n\nif (process.env.NODE_ENV !== \"production\") {\n\tglobalForStorage.storage = storage;\n}\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEA;;;CAGC,GACD,SAAS;IACR,OAAO,IAAI,4IAAQ,CAAC;QACnB,WAAW,qIAAG,CAAC,aAAa;QAC5B,aAAa,qIAAG,CAAC,gBAAgB;QACjC,iBAAiB,qIAAG,CAAC,oBAAoB;QACzC,YAAY,qIAAG,CAAC,cAAc;QAC9B,UAAU,qIAAG,CAAC,WAAW;QACzB,WAAW,qIAAG,CAAC,gBAAgB;IAChC;AACD;AAEA,sCAAsC;AACtC,MAAM,mBAAmB;AAIlB,MAAM,UAAU,iBAAiB,OAAO,IAAI;AAEnD,wCAA2C;IAC1C,iBAAiB,OAAO,GAAG;AAC5B"}},
    {"offset": {"line": 641, "column": 0}, "map": {"version":3,"sources":["file:///Users/bobkata/Projects/boostcart/apps/platform/src/server/services/media-cleanup.ts"],"sourcesContent":["import { env } from \"@/env\";\nimport { db } from \"@/server/db\";\nimport { storage } from \"@/server/storage\";\n\n/**\n * Extract image URLs from HTML content that belong to our R2 bucket\n */\nexport function extractR2ImageUrls(htmlContent: string): string[] {\n\tif (!htmlContent) return [];\n\n\tconst publicUrl = env.R2_CUSTOM_DOMAIN;\n\tif (!publicUrl) return [];\n\n\t// Match img src attributes that point to our R2 bucket\n\tconst imgRegex = /<img[^>]+src=[\"']([^\"']+)[\"'][^>]*>/gi;\n\tconst urls: string[] = [];\n\tlet match: RegExpExecArray | null;\n\n\twhile (true) {\n\t\tmatch = imgRegex.exec(htmlContent);\n\t\tif (!match) break;\n\t\tconst url = match[1];\n\t\tif (url?.startsWith(publicUrl)) {\n\t\t\turls.push(url);\n\t\t}\n\t}\n\n\treturn urls;\n}\n\n/**\n * Convert public URL to R2 key\n */\nexport function urlToR2Key(url: string): string | null {\n\tconst publicUrl = env.R2_CUSTOM_DOMAIN;\n\tif (!publicUrl || !url.startsWith(publicUrl)) return null;\n\n\t// Remove the public URL prefix to get the key\n\treturn url.slice(publicUrl.length + 1); // +1 for the trailing slash\n}\n\n/**\n * Check if an image URL is used in any blog post content\n */\nasync function isImageUsedInBlogPosts(\n\turl: string,\n\ttenantId: string,\n\texcludePostId?: string,\n): Promise<boolean> {\n\tconst posts = await db.blogPostTranslation.findMany({\n\t\twhere: {\n\t\t\tpost: { tenantId },\n\t\t\t...(excludePostId && { postId: { not: excludePostId } }),\n\t\t\tcontent: { contains: url },\n\t\t},\n\t\tselect: { id: true },\n\t\ttake: 1,\n\t});\n\n\treturn posts.length > 0;\n}\n\n/**\n * Check if an image URL is used in any page content\n */\nasync function isImageUsedInPages(\n\turl: string,\n\ttenantId: string,\n\texcludePageId?: string,\n): Promise<boolean> {\n\tconst pages = await db.pageTranslation.findMany({\n\t\twhere: {\n\t\t\tpage: { tenantId },\n\t\t\t...(excludePageId && { pageId: { not: excludePageId } }),\n\t\t\tcontent: { contains: url },\n\t\t},\n\t\tselect: { id: true },\n\t\ttake: 1,\n\t});\n\n\treturn pages.length > 0;\n}\n\n/**\n * Check if an image URL is used in product media\n */\nasync function isImageUsedInProducts(\n\turl: string,\n\ttenantId: string,\n): Promise<boolean> {\n\tconst media = await db.productMedia.findFirst({\n\t\twhere: {\n\t\t\tproduct: { tenantId },\n\t\t\turl,\n\t\t},\n\t\tselect: { id: true },\n\t});\n\n\treturn !!media;\n}\n\n/**\n * Check if an image is used anywhere in the tenant's content\n */\nexport async function isImageUsedElsewhere(\n\turl: string,\n\ttenantId: string,\n\tcontext: {\n\t\texcludeBlogPostId?: string;\n\t\texcludePageId?: string;\n\t} = {},\n): Promise<boolean> {\n\tconst [inBlogPosts, inPages, inProducts] = await Promise.all([\n\t\tisImageUsedInBlogPosts(url, tenantId, context.excludeBlogPostId),\n\t\tisImageUsedInPages(url, tenantId, context.excludePageId),\n\t\tisImageUsedInProducts(url, tenantId),\n\t]);\n\n\treturn inBlogPosts || inPages || inProducts;\n}\n\n/**\n * Delete images from R2 that are not used elsewhere\n * Returns the number of images deleted\n */\nexport async function cleanupUnusedImages(\n\timageUrls: string[],\n\ttenantId: string,\n\tcontext: {\n\t\texcludeBlogPostId?: string;\n\t\texcludePageId?: string;\n\t} = {},\n): Promise<number> {\n\tlet deletedCount = 0;\n\n\tfor (const url of imageUrls) {\n\t\tconst isUsed = await isImageUsedElsewhere(url, tenantId, context);\n\n\t\tif (!isUsed) {\n\t\t\tconst key = urlToR2Key(url);\n\t\t\tif (key) {\n\t\t\t\ttry {\n\t\t\t\t\tawait storage.delete(key);\n\t\t\t\t\tdeletedCount++;\n\t\t\t\t\tconsole.log(`[Media Cleanup] Deleted unused image: ${key}`);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error(\n\t\t\t\t\t\t`[Media Cleanup] Failed to delete image: ${key}`,\n\t\t\t\t\t\terror,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn deletedCount;\n}\n\n/**\n * Cleanup images from blog post content\n */\nexport async function cleanupBlogPostImages(\n\tcontent: string,\n\ttenantId: string,\n\tblogPostId: string,\n): Promise<number> {\n\tconst imageUrls = extractR2ImageUrls(content);\n\tif (imageUrls.length === 0) return 0;\n\n\treturn cleanupUnusedImages(imageUrls, tenantId, {\n\t\texcludeBlogPostId: blogPostId,\n\t});\n}\n\n/**\n * Cleanup images from page content\n */\nexport async function cleanupPageImages(\n\tcontent: string,\n\ttenantId: string,\n\tpageId: string,\n): Promise<number> {\n\tconst imageUrls = extractR2ImageUrls(content);\n\tif (imageUrls.length === 0) return 0;\n\n\treturn cleanupUnusedImages(imageUrls, tenantId, {\n\t\texcludePageId: pageId,\n\t});\n}\n\n/**\n * Cleanup product media files\n */\nexport async function cleanupProductMedia(\n\tmediaUrls: string[],\n\ttenantId: string,\n): Promise<number> {\n\tlet deletedCount = 0;\n\n\tfor (const url of mediaUrls) {\n\t\t// Check if the URL is from our R2 bucket\n\t\tconst key = urlToR2Key(url);\n\t\tif (!key) continue;\n\n\t\t// Check if this media is used in other products or content\n\t\tconst isUsed = await isImageUsedElsewhere(url, tenantId);\n\n\t\tif (!isUsed) {\n\t\t\ttry {\n\t\t\t\tawait storage.delete(key);\n\t\t\t\tdeletedCount++;\n\t\t\t\tconsole.log(`[Media Cleanup] Deleted product media: ${key}`);\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(`[Media Cleanup] Failed to delete media: ${key}`, error);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn deletedCount;\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 823, "column": 0}, "map": {"version":3,"sources":["file:///Users/bobkata/Projects/boostcart/apps/platform/src/lib/tenant.ts"],"sourcesContent":["import type { Tenant } from \"@boostcart/database\";\nimport { db } from \"@/server/db\";\n\n// Cache for tenant lookups\nconst tenantCache = new Map<string, { tenant: Tenant; expiry: number }>();\nconst CACHE_TTL = 60 * 1000; // 1 minute\n\n/**\n * Get tenant by subdomain (slug)\n */\nexport async function getTenantBySlug(slug: string): Promise<Tenant | null> {\n\t// Check cache first\n\tconst cached = tenantCache.get(`slug:${slug}`);\n\tif (cached && cached.expiry > Date.now()) {\n\t\treturn cached.tenant;\n\t}\n\n\tconst tenant = await db.tenant.findFirst({\n\t\twhere: {\n\t\t\tslug,\n\t\t\tisActive: true,\n\t\t\tdeletedAt: null,\n\t\t},\n\t});\n\n\tif (tenant) {\n\t\ttenantCache.set(`slug:${slug}`, {\n\t\t\ttenant,\n\t\t\texpiry: Date.now() + CACHE_TTL,\n\t\t});\n\t}\n\n\treturn tenant;\n}\n\n/**\n * Get tenant by custom domain\n */\nexport async function getTenantByDomain(\n\tdomain: string,\n): Promise<Tenant | null> {\n\t// Check cache first\n\tconst cached = tenantCache.get(`domain:${domain}`);\n\tif (cached && cached.expiry > Date.now()) {\n\t\treturn cached.tenant;\n\t}\n\n\tconst tenantDomain = await db.tenantDomain.findFirst({\n\t\twhere: {\n\t\t\tdomain,\n\t\t\tdnsVerified: true,\n\t\t},\n\t\tinclude: {\n\t\t\ttenant: true,\n\t\t},\n\t});\n\n\tif (tenantDomain?.tenant && tenantDomain.tenant.isActive) {\n\t\ttenantCache.set(`domain:${domain}`, {\n\t\t\ttenant: tenantDomain.tenant,\n\t\t\texpiry: Date.now() + CACHE_TTL,\n\t\t});\n\t\treturn tenantDomain.tenant;\n\t}\n\n\treturn null;\n}\n\n/**\n * Extract tenant from request hostname\n */\nexport async function getTenantFromRequest(\n\thostname: string | null,\n): Promise<Tenant | null> {\n\tif (!hostname) return null;\n\n\t// Remove port if present\n\tconst host = hostname.split(\":\")[0];\n\tif (!host) return null;\n\n\t// Check if it's the main platform domain\n\tconst platformDomains = [\"boostcart.bg\", \"localhost\", \"127.0.0.1\"];\n\tconst isMainDomain = platformDomains.some(\n\t\t(d) => host === d || host === `www.${d}`,\n\t);\n\n\tif (isMainDomain) {\n\t\t// No tenant for main domain\n\t\treturn null;\n\t}\n\n\t// Check for subdomain (e.g., store.boostcart.bg)\n\tconst subdomainMatch = host.match(/^([a-z0-9-]+)\\.boostcart\\.bg$/i);\n\tif (subdomainMatch?.[1]) {\n\t\tconst slug = subdomainMatch[1];\n\t\t// Skip common subdomains\n\t\tif ([\"www\", \"api\", \"admin\", \"staging\", \"dev\"].includes(slug)) {\n\t\t\treturn null;\n\t\t}\n\t\treturn getTenantBySlug(slug);\n\t}\n\n\t// Check for local dev subdomain (e.g., store.localhost)\n\tconst localSubdomainMatch = host.match(/^([a-z0-9-]+)\\.localhost$/i);\n\tif (localSubdomainMatch?.[1]) {\n\t\treturn getTenantBySlug(localSubdomainMatch[1]);\n\t}\n\n\t// Otherwise, check if it's a custom domain\n\treturn getTenantByDomain(host);\n}\n\n/**\n * Clear tenant cache (useful after updates)\n */\nexport function clearTenantCache(identifier?: string) {\n\tif (identifier) {\n\t\ttenantCache.delete(`slug:${identifier}`);\n\t\ttenantCache.delete(`domain:${identifier}`);\n\t} else {\n\t\ttenantCache.clear();\n\t}\n}\n"],"names":[],"mappings":";;;;;;;;;;AACA;;;;;;AAEA,2BAA2B;AAC3B,MAAM,cAAc,IAAI;AACxB,MAAM,YAAY,KAAK,MAAM,WAAW;AAKjC,eAAe,gBAAgB,IAAY;IACjD,oBAAoB;IACpB,MAAM,SAAS,YAAY,GAAG,CAAC,CAAC,KAAK,EAAE,MAAM;IAC7C,IAAI,UAAU,OAAO,MAAM,GAAG,KAAK,GAAG,IAAI;QACzC,OAAO,OAAO,MAAM;IACrB;IAEA,MAAM,SAAS,MAAM,6IAAE,CAAC,MAAM,CAAC,SAAS,CAAC;QACxC,OAAO;YACN;YACA,UAAU;YACV,WAAW;QACZ;IACD;IAEA,IAAI,QAAQ;QACX,YAAY,GAAG,CAAC,CAAC,KAAK,EAAE,MAAM,EAAE;YAC/B;YACA,QAAQ,KAAK,GAAG,KAAK;QACtB;IACD;IAEA,OAAO;AACR;AAKO,eAAe,kBACrB,MAAc;IAEd,oBAAoB;IACpB,MAAM,SAAS,YAAY,GAAG,CAAC,CAAC,OAAO,EAAE,QAAQ;IACjD,IAAI,UAAU,OAAO,MAAM,GAAG,KAAK,GAAG,IAAI;QACzC,OAAO,OAAO,MAAM;IACrB;IAEA,MAAM,eAAe,MAAM,6IAAE,CAAC,YAAY,CAAC,SAAS,CAAC;QACpD,OAAO;YACN;YACA,aAAa;QACd;QACA,SAAS;YACR,QAAQ;QACT;IACD;IAEA,IAAI,cAAc,UAAU,aAAa,MAAM,CAAC,QAAQ,EAAE;QACzD,YAAY,GAAG,CAAC,CAAC,OAAO,EAAE,QAAQ,EAAE;YACnC,QAAQ,aAAa,MAAM;YAC3B,QAAQ,KAAK,GAAG,KAAK;QACtB;QACA,OAAO,aAAa,MAAM;IAC3B;IAEA,OAAO;AACR;AAKO,eAAe,qBACrB,QAAuB;IAEvB,IAAI,CAAC,UAAU,OAAO;IAEtB,yBAAyB;IACzB,MAAM,OAAO,SAAS,KAAK,CAAC,IAAI,CAAC,EAAE;IACnC,IAAI,CAAC,MAAM,OAAO;IAElB,yCAAyC;IACzC,MAAM,kBAAkB;QAAC;QAAgB;QAAa;KAAY;IAClE,MAAM,eAAe,gBAAgB,IAAI,CACxC,CAAC,IAAM,SAAS,KAAK,SAAS,CAAC,IAAI,EAAE,GAAG;IAGzC,IAAI,cAAc;QACjB,4BAA4B;QAC5B,OAAO;IACR;IAEA,iDAAiD;IACjD,MAAM,iBAAiB,KAAK,KAAK,CAAC;IAClC,IAAI,gBAAgB,CAAC,EAAE,EAAE;QACxB,MAAM,OAAO,cAAc,CAAC,EAAE;QAC9B,yBAAyB;QACzB,IAAI;YAAC;YAAO;YAAO;YAAS;YAAW;SAAM,CAAC,QAAQ,CAAC,OAAO;YAC7D,OAAO;QACR;QACA,OAAO,gBAAgB;IACxB;IAEA,wDAAwD;IACxD,MAAM,sBAAsB,KAAK,KAAK,CAAC;IACvC,IAAI,qBAAqB,CAAC,EAAE,EAAE;QAC7B,OAAO,gBAAgB,mBAAmB,CAAC,EAAE;IAC9C;IAEA,2CAA2C;IAC3C,OAAO,kBAAkB;AAC1B;AAKO,SAAS,iBAAiB,UAAmB;IACnD,IAAI,YAAY;QACf,YAAY,MAAM,CAAC,CAAC,KAAK,EAAE,YAAY;QACvC,YAAY,MAAM,CAAC,CAAC,OAAO,EAAE,YAAY;IAC1C,OAAO;QACN,YAAY,KAAK;IAClB;AACD"}},
    {"offset": {"line": 942, "column": 0}, "map": {"version":3,"sources":["file:///Users/bobkata/Projects/boostcart/apps/platform/src/server/tenant.ts"],"sourcesContent":["\"use server\";\n\nimport type { Tenant } from \"@boostcart/database\";\nimport { headers } from \"next/headers\";\nimport { cache } from \"react\";\nimport { getTenantByDomain, getTenantBySlug } from \"@/lib/tenant\";\nimport { auth } from \"./auth\";\nimport { db } from \"./db\";\n\n/**\n * Get the current tenant from the request context (storefront)\n * This is cached per-request using React's cache()\n */\nexport const getCurrentTenant = cache(async (): Promise<Tenant | null> => {\n\tconst headersList = await headers();\n\n\t// Check for tenant slug from subdomain\n\tconst tenantSlug = headersList.get(\"x-tenant-slug\");\n\tif (tenantSlug) {\n\t\treturn getTenantBySlug(tenantSlug);\n\t}\n\n\t// Check for custom domain\n\tconst customDomain = headersList.get(\"x-custom-domain\");\n\tif (customDomain) {\n\t\treturn getTenantByDomain(customDomain);\n\t}\n\n\treturn null;\n});\n\n/**\n * Get the current tenant for admin context (from user's store ownership)\n * This is used when accessing via boostcart.bg/admin (not subdomain)\n */\nexport const getAdminTenant = cache(async (): Promise<Tenant | null> => {\n\tconst session = await auth();\n\tif (!session?.user?.id) {\n\t\treturn null;\n\t}\n\n\t// Get the user's primary store (first store they have access to)\n\tconst staffRecord = await db.tenantStaff.findFirst({\n\t\twhere: { userId: session.user.id },\n\t\tinclude: { tenant: true },\n\t\torderBy: { createdAt: \"asc\" },\n\t});\n\n\treturn staffRecord?.tenant ?? null;\n});\n\n/**\n * Require tenant to be present (storefront context), throws if not found\n */\nexport async function requireTenant(): Promise<Tenant> {\n\tconst tenant = await getCurrentTenant();\n\tif (!tenant) {\n\t\tthrow new Error(\"Tenant not found\");\n\t}\n\treturn tenant;\n}\n\n/**\n * Require tenant for admin operations\n * First checks storefront context, then falls back to user's store\n */\nexport async function requireAdminTenant(): Promise<Tenant> {\n\t// First try storefront context (subdomain access)\n\tconst storefrontTenant = await getCurrentTenant();\n\tif (storefrontTenant) {\n\t\treturn storefrontTenant;\n\t}\n\n\t// Fall back to user's store (main domain admin access)\n\tconst adminTenant = await getAdminTenant();\n\tif (adminTenant) {\n\t\treturn adminTenant;\n\t}\n\n\tthrow new Error(\"No tenant context found. Please create or select a store.\");\n}\n\n/**\n * Check if we're in a tenant context\n */\nexport async function hasTenantContext(): Promise<boolean> {\n\tconst tenant = await getCurrentTenant();\n\treturn tenant !== null;\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;AAGA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;AAMO,MAAM,mBAAmB,IAAA,8MAAK,EAAC;IACrC,MAAM,cAAc,MAAM,IAAA,0IAAO;IAEjC,uCAAuC;IACvC,MAAM,aAAa,YAAY,GAAG,CAAC;IACnC,IAAI,YAAY;QACf,OAAO,IAAA,2JAAe,EAAC;IACxB;IAEA,0BAA0B;IAC1B,MAAM,eAAe,YAAY,GAAG,CAAC;IACrC,IAAI,cAAc;QACjB,OAAO,IAAA,6JAAiB,EAAC;IAC1B;IAEA,OAAO;AACR;AAMO,MAAM,iBAAiB,IAAA,8MAAK,EAAC;IACnC,MAAM,UAAU,MAAM,IAAA,0KAAI;IAC1B,IAAI,CAAC,SAAS,MAAM,IAAI;QACvB,OAAO;IACR;IAEA,iEAAiE;IACjE,MAAM,cAAc,MAAM,6IAAE,CAAC,WAAW,CAAC,SAAS,CAAC;QAClD,OAAO;YAAE,QAAQ,QAAQ,IAAI,CAAC,EAAE;QAAC;QACjC,SAAS;YAAE,QAAQ;QAAK;QACxB,SAAS;YAAE,WAAW;QAAM;IAC7B;IAEA,OAAO,aAAa,UAAU;AAC/B;AAKO,eAAe;IACrB,MAAM,SAAS,MAAM;IACrB,IAAI,CAAC,QAAQ;QACZ,MAAM,IAAI,MAAM;IACjB;IACA,OAAO;AACR;AAMO,eAAe;IACrB,kDAAkD;IAClD,MAAM,mBAAmB,MAAM;IAC/B,IAAI,kBAAkB;QACrB,OAAO;IACR;IAEA,uDAAuD;IACvD,MAAM,cAAc,MAAM;IAC1B,IAAI,aAAa;QAChB,OAAO;IACR;IAEA,MAAM,IAAI,MAAM;AACjB;AAKO,eAAe;IACrB,MAAM,SAAS,MAAM;IACrB,OAAO,WAAW;AACnB;;;IAlCsB;IAYA;IAmBA;;;;AA/BA,+OAAA;AAYA,+OAAA;AAmBA,+OAAA"}},
    {"offset": {"line": 1050, "column": 0}, "map": {"version":3,"sources":["file:///Users/bobkata/Projects/boostcart/apps/platform/src/server/api/internal/products.ts"],"sourcesContent":["\"use server\";\n\nimport { revalidatePath } from \"next/cache\";\nimport {\n\ttype CreateProductInput,\n\tCreateProductSchema,\n\ttype ProductFilterInput,\n\tProductFilterSchema,\n\ttype UpdateProductInput,\n\tUpdateProductSchema,\n} from \"@/schemas/product\";\nimport { auth } from \"@/server/auth\";\nimport { db } from \"@/server/db\";\nimport { cleanupProductMedia } from \"@/server/services/media-cleanup\";\nimport { requireAdminTenant } from \"@/server/tenant\";\n\n// Helper to check access and get tenant context for admin operations\nasync function requireStoreAccess() {\n\tconst session = await auth();\n\tif (!session?.user?.id) {\n\t\tthrow new Error(\"Unauthorized\");\n\t}\n\n\t// Get tenant context (from user's store membership)\n\tconst tenant = await requireAdminTenant();\n\n\t// Verify user has access to this tenant\n\tconst staffRecord = await db.tenantStaff.findFirst({\n\t\twhere: {\n\t\t\tuserId: session.user.id,\n\t\t\ttenantId: tenant.id,\n\t\t},\n\t});\n\n\tif (!staffRecord) {\n\t\tthrow new Error(\"Forbidden: No access to this store\");\n\t}\n\n\treturn {\n\t\tuserId: session.user.id,\n\t\ttenantId: tenant.id,\n\t\trole: staffRecord.role,\n\t};\n}\n\n// Get products with filters\nexport async function getProducts(filters?: ProductFilterInput) {\n\tconst { tenantId } = await requireStoreAccess();\n\n\tconst validatedFilters = filters\n\t\t? ProductFilterSchema.parse(filters)\n\t\t: { page: 1, pageSize: 20 };\n\n\tconst {\n\t\tpage,\n\t\tpageSize,\n\t\tsearch,\n\t\tstatus,\n\t\tcategoryIds,\n\t\tbrandIds,\n\t\tstockStatus,\n\t\tpriceMin,\n\t\tpriceMax,\n\t\tsortBy,\n\t} = validatedFilters;\n\n\tconst where: Record<string, unknown> = {\n\t\ttenantId, // Filter by current tenant\n\t\tdeletedAt: null, // Only active products\n\t};\n\n\t// Search\n\tif (search) {\n\t\twhere.OR = [\n\t\t\t{ sku: { contains: search, mode: \"insensitive\" } },\n\t\t\t{\n\t\t\t\ttranslations: {\n\t\t\t\t\tsome: { name: { contains: search, mode: \"insensitive\" } },\n\t\t\t\t},\n\t\t\t},\n\t\t];\n\t}\n\n\t// Status filter\n\tif (status && status.length > 0) {\n\t\twhere.status = { in: status };\n\t}\n\n\t// Category filter\n\tif (categoryIds && categoryIds.length > 0) {\n\t\twhere.categoryId = { in: categoryIds };\n\t}\n\n\t// Brand filter\n\tif (brandIds && brandIds.length > 0) {\n\t\twhere.brandId = { in: brandIds };\n\t}\n\n\t// Stock status filter\n\tif (stockStatus) {\n\t\tswitch (stockStatus) {\n\t\t\tcase \"in_stock\":\n\t\t\t\twhere.OR = [{ trackStock: false }, { stock: { gt: 10 } }];\n\t\t\t\tbreak;\n\t\t\tcase \"low_stock\":\n\t\t\t\twhere.trackStock = true;\n\t\t\t\twhere.stock = { gt: 0, lte: 10 };\n\t\t\t\tbreak;\n\t\t\tcase \"out_of_stock\":\n\t\t\t\twhere.trackStock = true;\n\t\t\t\twhere.stock = 0;\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t// Price filter\n\tif (priceMin !== undefined || priceMax !== undefined) {\n\t\twhere.price = {};\n\t\tif (priceMin !== undefined) {\n\t\t\t(where.price as Record<string, number>).gte = priceMin;\n\t\t}\n\t\tif (priceMax !== undefined) {\n\t\t\t(where.price as Record<string, number>).lte = priceMax;\n\t\t}\n\t}\n\n\t// Sorting\n\tconst orderBy: Record<string, string>[] = [];\n\tif (sortBy) {\n\t\tswitch (sortBy) {\n\t\t\tcase \"name_asc\":\n\t\t\tcase \"name_desc\":\n\t\t\t\t// For name sorting, we need to sort by translation\n\t\t\t\t// This is a workaround - ideally we'd join and sort\n\t\t\t\tbreak;\n\t\t\tcase \"price_asc\":\n\t\t\t\torderBy.push({ price: \"asc\" });\n\t\t\t\tbreak;\n\t\t\tcase \"price_desc\":\n\t\t\t\torderBy.push({ price: \"desc\" });\n\t\t\t\tbreak;\n\t\t\tcase \"created_asc\":\n\t\t\t\torderBy.push({ createdAt: \"asc\" });\n\t\t\t\tbreak;\n\t\t\tcase \"created_desc\":\n\t\t\t\torderBy.push({ createdAt: \"desc\" });\n\t\t\t\tbreak;\n\t\t\tcase \"stock_asc\":\n\t\t\t\torderBy.push({ stock: \"asc\" });\n\t\t\t\tbreak;\n\t\t\tcase \"stock_desc\":\n\t\t\t\torderBy.push({ stock: \"desc\" });\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tif (orderBy.length === 0) {\n\t\torderBy.push({ createdAt: \"desc\" });\n\t}\n\n\tconst [products, total] = await Promise.all([\n\t\tdb.product.findMany({\n\t\t\twhere,\n\t\t\torderBy,\n\t\t\tskip: (page - 1) * pageSize,\n\t\t\ttake: pageSize,\n\t\t\tinclude: {\n\t\t\t\tcategory: {\n\t\t\t\t\tinclude: {\n\t\t\t\t\t\ttranslations: {\n\t\t\t\t\t\t\twhere: { localeId: \"en\" },\n\t\t\t\t\t\t\ttake: 1,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tbrand: {\n\t\t\t\t\tinclude: {\n\t\t\t\t\t\ttranslations: {\n\t\t\t\t\t\t\twhere: { localeId: \"en\" },\n\t\t\t\t\t\t\ttake: 1,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\ttranslations: {\n\t\t\t\t\twhere: { localeId: \"en\" },\n\t\t\t\t\ttake: 1,\n\t\t\t\t},\n\t\t\t\tmedia: {\n\t\t\t\t\torderBy: { order: \"asc\" },\n\t\t\t\t\ttake: 1,\n\t\t\t\t},\n\t\t\t},\n\t\t}),\n\t\tdb.product.count({ where }),\n\t]);\n\n\treturn {\n\t\tproducts: products.map((p) => ({\n\t\t\tid: p.id,\n\t\t\tslug: p.slug,\n\t\t\tstatus: p.status,\n\t\t\tprice: p.price,\n\t\t\tcompareAtPrice: p.compareAtPrice,\n\t\t\tsku: p.sku,\n\t\t\ttrackStock: p.trackStock,\n\t\t\tstock: p.stock,\n\t\t\tname: p.translations[0]?.name ?? \"Untitled\",\n\t\t\tdescription: p.translations[0]?.description,\n\t\t\tcategoryId: p.categoryId,\n\t\t\tcategoryName: p.category?.translations[0]?.name ?? \"Uncategorized\",\n\t\t\tbrandId: p.brandId,\n\t\t\tbrandName: p.brand?.translations[0]?.name,\n\t\t\timageUrl: p.media[0]?.url,\n\t\t\tcreatedAt: p.createdAt,\n\t\t\tupdatedAt: p.updatedAt,\n\t\t})),\n\t\tpagination: {\n\t\t\tpage,\n\t\t\tpageSize,\n\t\t\ttotal,\n\t\t\ttotalPages: Math.ceil(total / pageSize),\n\t\t},\n\t};\n}\n\n// Get single product by ID\nexport async function getProduct(productId: string) {\n\tconst { tenantId } = await requireStoreAccess();\n\n\tconst product = await db.product.findFirst({\n\t\twhere: { id: productId, tenantId },\n\t\tinclude: {\n\t\t\ttranslations: true,\n\t\t\tmedia: { orderBy: { order: \"asc\" } },\n\t\t\tvariants: {\n\t\t\t\tinclude: {\n\t\t\t\t\toptionMeta: true,\n\t\t\t\t},\n\t\t\t},\n\t\t\tshippingInfo: true,\n\t\t\tcollectionProducts: {\n\t\t\t\tinclude: {\n\t\t\t\t\tcollection: {\n\t\t\t\t\t\tinclude: {\n\t\t\t\t\t\t\ttranslations: {\n\t\t\t\t\t\t\t\twhere: { localeId: \"en\" },\n\t\t\t\t\t\t\t\ttake: 1,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t});\n\n\tif (!product) {\n\t\tthrow new Error(\"Product not found\");\n\t}\n\n\tconst englishTranslation = product.translations.find(\n\t\t(t: { localeId: string }) => t.localeId === \"en\",\n\t);\n\n\treturn {\n\t\tid: product.id,\n\t\tslug: product.slug,\n\t\tstatus: product.status,\n\t\tcategoryId: product.categoryId,\n\t\tbrandId: product.brandId,\n\t\tprice: product.price,\n\t\tcompareAtPrice: product.compareAtPrice,\n\t\tcostPerItem: product.costPerItem,\n\t\tsku: product.sku,\n\t\ttrackStock: product.trackStock,\n\t\tstock: product.stock,\n\t\tlowStockThreshold: product.lowStockThreshold,\n\t\tpurchaseType: product.purchaseType,\n\t\tsubscriptionDiscountPercent: product.subscriptionDiscountPercent,\n\t\tsubscriptionIntervals: product.subscriptionIntervals,\n\t\tpreOrderReleaseDate: product.preOrderReleaseDate,\n\t\tpreOrderDepositPercent: product.preOrderDepositPercent,\n\t\tunitPriceAmount: product.unitPriceAmount,\n\t\tunitPriceMeasurement: product.unitPriceMeasurement,\n\t\tunitPriceBaseAmount: product.unitPriceBaseAmount,\n\t\tunitPriceBaseMeasurement: product.unitPriceBaseMeasurement,\n\t\tname: englishTranslation?.name ?? \"\",\n\t\tdescription: englishTranslation?.description ?? \"\",\n\t\tmedia: product.media.map(\n\t\t\t(m: {\n\t\t\t\tid: string;\n\t\t\t\turl: string;\n\t\t\t\tmediaType: string;\n\t\t\t\taltText: string | null;\n\t\t\t\torder: number;\n\t\t\t}) => ({\n\t\t\t\tid: m.id,\n\t\t\t\turl: m.url,\n\t\t\t\tmediaType: m.mediaType,\n\t\t\t\taltText: m.altText,\n\t\t\t\torder: m.order,\n\t\t\t}),\n\t\t),\n\t\tvariants: product.variants.map(\n\t\t\t(v: {\n\t\t\t\tid: string;\n\t\t\t\tsku: string | null;\n\t\t\t\tprice: unknown;\n\t\t\t\tpriceAdjustment: unknown;\n\t\t\t\tstock: number | null;\n\t\t\t\timageUrl: string | null;\n\t\t\t\toptions: unknown;\n\t\t\t\toptionMeta: unknown[];\n\t\t\t}) => ({\n\t\t\t\tid: v.id,\n\t\t\t\tsku: v.sku,\n\t\t\t\tprice: v.price,\n\t\t\t\tpriceAdjustment: v.priceAdjustment,\n\t\t\t\tstock: v.stock,\n\t\t\t\timageUrl: v.imageUrl,\n\t\t\t\toptions: v.options as Record<string, string>,\n\t\t\t\toptionMeta: v.optionMeta,\n\t\t\t}),\n\t\t),\n\t\tshippingInfo: product.shippingInfo\n\t\t\t? {\n\t\t\t\t\tpackageType: product.shippingInfo.packageType,\n\t\t\t\t\tpackagingWeightKg: product.shippingInfo.packagingWeightKg,\n\t\t\t\t\tpackagingLengthCm: product.shippingInfo.packagingLengthCm,\n\t\t\t\t\tpackagingWidthCm: product.shippingInfo.packagingWidthCm,\n\t\t\t\t\tpackagingHeightCm: product.shippingInfo.packagingHeightCm,\n\t\t\t\t\tproductWeightKg: product.shippingInfo.productWeightKg,\n\t\t\t\t\tproductLengthCm: product.shippingInfo.productLengthCm,\n\t\t\t\t\tproductWidthCm: product.shippingInfo.productWidthCm,\n\t\t\t\t\tproductHeightCm: product.shippingInfo.productHeightCm,\n\t\t\t\t}\n\t\t\t: null,\n\t\tseo: {\n\t\t\tmetaTitle: englishTranslation?.metaTitle,\n\t\t\tmetaDescription: englishTranslation?.metaDescription,\n\t\t\tslug: product.slug,\n\t\t},\n\t\tcollectionIds: product.collectionProducts.map(\n\t\t\t(c: { collectionId: string }) => c.collectionId,\n\t\t),\n\t};\n}\n\n// Create product\nexport async function createProduct(input: CreateProductInput) {\n\tconst { tenantId } = await requireStoreAccess();\n\n\tconst validatedInput = CreateProductSchema.parse(input);\n\n\tconst product = await db.$transaction(async (tx) => {\n\t\t// Create the product\n\t\tconst newProduct = await tx.product.create({\n\t\t\tdata: {\n\t\t\t\ttenantId,\n\t\t\t\tslug: validatedInput.slug,\n\t\t\t\tstatus: validatedInput.status,\n\t\t\t\tcategoryId: validatedInput.categoryId,\n\t\t\t\tbrandId: validatedInput.brandId || null,\n\t\t\t\tprice: validatedInput.price,\n\t\t\t\tcompareAtPrice: validatedInput.compareAtPrice,\n\t\t\t\tcostPerItem: validatedInput.costPerItem,\n\t\t\t\tsku: validatedInput.sku,\n\t\t\t\ttrackStock: validatedInput.trackStock,\n\t\t\t\tstock: validatedInput.stock,\n\t\t\t\tlowStockThreshold: validatedInput.lowStockThreshold,\n\t\t\t\t// Purchase options\n\t\t\t\tpurchaseType: validatedInput.purchaseOptions?.type ?? \"ONE_TIME\",\n\t\t\t\tsubscriptionDiscountPercent:\n\t\t\t\t\tvalidatedInput.purchaseOptions?.subscriptionDiscount,\n\t\t\t\tsubscriptionIntervals:\n\t\t\t\t\tvalidatedInput.purchaseOptions?.subscriptionIntervals ?? [],\n\t\t\t\tpreOrderReleaseDate:\n\t\t\t\t\tvalidatedInput.purchaseOptions?.preOrderReleaseDate,\n\t\t\t\tpreOrderDepositPercent:\n\t\t\t\t\tvalidatedInput.purchaseOptions?.preOrderDepositPercent,\n\t\t\t\t// Unit pricing\n\t\t\t\tunitPriceAmount: validatedInput.unitPrice?.unitPriceAmount,\n\t\t\t\tunitPriceMeasurement: validatedInput.unitPrice?.unitPriceMeasurement,\n\t\t\t\tunitPriceBaseAmount: validatedInput.unitPrice?.unitPriceBaseAmount,\n\t\t\t\tunitPriceBaseMeasurement:\n\t\t\t\t\tvalidatedInput.unitPrice?.unitPriceBaseMeasurement,\n\t\t\t},\n\t\t});\n\n\t\t// Create translation (English by default)\n\t\tawait tx.productTranslation.create({\n\t\t\tdata: {\n\t\t\t\tproductId: newProduct.id,\n\t\t\t\tlocaleId: \"en\",\n\t\t\t\tname: validatedInput.name,\n\t\t\t\tdescription: validatedInput.description,\n\t\t\t\tmetaTitle: validatedInput.seo?.metaTitle,\n\t\t\t\tmetaDescription: validatedInput.seo?.metaDescription,\n\t\t\t},\n\t\t});\n\n\t\t// Create media\n\t\tif (validatedInput.media && validatedInput.media.length > 0) {\n\t\t\tawait tx.productMedia.createMany({\n\t\t\t\tdata: validatedInput.media.map((m, index) => ({\n\t\t\t\t\tproductId: newProduct.id,\n\t\t\t\t\turl: m.url,\n\t\t\t\t\tmediaType: m.mediaType,\n\t\t\t\t\taltText: m.altText,\n\t\t\t\t\torder: m.order ?? index,\n\t\t\t\t})),\n\t\t\t});\n\t\t}\n\n\t\t// Create variants\n\t\tif (validatedInput.variants && validatedInput.variants.length > 0) {\n\t\t\tfor (const variant of validatedInput.variants) {\n\t\t\t\tconst createdVariant = await tx.productVariant.create({\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tproductId: newProduct.id,\n\t\t\t\t\t\tsku: variant.sku,\n\t\t\t\t\t\tprice: variant.price,\n\t\t\t\t\t\tpriceAdjustment: variant.priceAdjustment ?? 0,\n\t\t\t\t\t\tstock: variant.stock,\n\t\t\t\t\t\timageUrl: variant.imageUrl,\n\t\t\t\t\t\toptions: variant.options,\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\t// Create variant option meta (for colors)\n\t\t\t\tif (variant.optionMeta && variant.optionMeta.length > 0) {\n\t\t\t\t\tawait tx.variantOptionMeta.createMany({\n\t\t\t\t\t\tdata: variant.optionMeta.map((meta) => ({\n\t\t\t\t\t\t\tvariantId: createdVariant.id,\n\t\t\t\t\t\t\toptionName: meta.optionName,\n\t\t\t\t\t\t\thexColor: meta.hexColor,\n\t\t\t\t\t\t})),\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Create shipping info\n\t\tif (validatedInput.shippingInfo) {\n\t\t\tawait tx.productShippingInfo.create({\n\t\t\t\tdata: {\n\t\t\t\t\tproductId: newProduct.id,\n\t\t\t\t\tpackageType: validatedInput.shippingInfo.packageType,\n\t\t\t\t\tpackagingWeightKg: validatedInput.shippingInfo.weight,\n\t\t\t\t\tpackagingLengthCm: validatedInput.shippingInfo.packageLength,\n\t\t\t\t\tpackagingWidthCm: validatedInput.shippingInfo.packageWidth,\n\t\t\t\t\tpackagingHeightCm: validatedInput.shippingInfo.packageHeight,\n\t\t\t\t\tproductWeightKg: validatedInput.shippingInfo.productWeight,\n\t\t\t\t\tproductLengthCm: validatedInput.shippingInfo.productLength,\n\t\t\t\t\tproductWidthCm: validatedInput.shippingInfo.productWidth,\n\t\t\t\t\tproductHeightCm: validatedInput.shippingInfo.productHeight,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\t// Link to collections\n\t\tif (\n\t\t\tvalidatedInput.collectionIds &&\n\t\t\tvalidatedInput.collectionIds.length > 0\n\t\t) {\n\t\t\tawait tx.collectionProduct.createMany({\n\t\t\t\tdata: validatedInput.collectionIds.map((collectionId) => ({\n\t\t\t\t\tproductId: newProduct.id,\n\t\t\t\t\tcollectionId,\n\t\t\t\t})),\n\t\t\t});\n\t\t}\n\n\t\treturn newProduct;\n\t});\n\n\trevalidatePath(\"/admin/products\");\n\n\treturn { success: true, productId: product.id };\n}\n\n// Update product\nexport async function updateProduct(input: UpdateProductInput) {\n\tconst { tenantId } = await requireStoreAccess();\n\n\tconst validatedInput = UpdateProductSchema.parse(input);\n\n\t// Verify product belongs to tenant\n\tconst existingProduct = await db.product.findFirst({\n\t\twhere: { id: validatedInput.id, tenantId },\n\t});\n\tif (!existingProduct) {\n\t\tthrow new Error(\"Product not found\");\n\t}\n\n\tawait db.$transaction(async (tx) => {\n\t\t// Update the main product\n\t\tawait tx.product.update({\n\t\t\twhere: { id: validatedInput.id },\n\t\t\tdata: {\n\t\t\t\t...(validatedInput.slug && { slug: validatedInput.slug }),\n\t\t\t\t...(validatedInput.status && { status: validatedInput.status }),\n\t\t\t\t...(validatedInput.categoryId && {\n\t\t\t\t\tcategoryId: validatedInput.categoryId,\n\t\t\t\t}),\n\t\t\t\tbrandId: validatedInput.brandId || null,\n\t\t\t\t...(validatedInput.price !== undefined && {\n\t\t\t\t\tprice: validatedInput.price,\n\t\t\t\t}),\n\t\t\t\tcompareAtPrice: validatedInput.compareAtPrice,\n\t\t\t\tcostPerItem: validatedInput.costPerItem,\n\t\t\t\tsku: validatedInput.sku,\n\t\t\t\ttrackStock: validatedInput.trackStock,\n\t\t\t\tstock: validatedInput.stock,\n\t\t\t\tlowStockThreshold: validatedInput.lowStockThreshold,\n\t\t\t\t// Purchase options\n\t\t\t\t...(validatedInput.purchaseOptions && {\n\t\t\t\t\tpurchaseType: validatedInput.purchaseOptions.type,\n\t\t\t\t\tsubscriptionDiscountPercent:\n\t\t\t\t\t\tvalidatedInput.purchaseOptions.subscriptionDiscount,\n\t\t\t\t\tsubscriptionIntervals:\n\t\t\t\t\t\tvalidatedInput.purchaseOptions.subscriptionIntervals ?? [],\n\t\t\t\t\tpreOrderReleaseDate:\n\t\t\t\t\t\tvalidatedInput.purchaseOptions.preOrderReleaseDate,\n\t\t\t\t\tpreOrderDepositPercent:\n\t\t\t\t\t\tvalidatedInput.purchaseOptions.preOrderDepositPercent,\n\t\t\t\t}),\n\t\t\t\t// Unit pricing\n\t\t\t\t...(validatedInput.unitPrice && {\n\t\t\t\t\tunitPriceAmount: validatedInput.unitPrice.unitPriceAmount,\n\t\t\t\t\tunitPriceMeasurement: validatedInput.unitPrice.unitPriceMeasurement,\n\t\t\t\t\tunitPriceBaseAmount: validatedInput.unitPrice.unitPriceBaseAmount,\n\t\t\t\t\tunitPriceBaseMeasurement:\n\t\t\t\t\t\tvalidatedInput.unitPrice.unitPriceBaseMeasurement,\n\t\t\t\t}),\n\t\t\t},\n\t\t});\n\n\t\t// Update translation\n\t\tif (\n\t\t\tvalidatedInput.name ||\n\t\t\tvalidatedInput.description ||\n\t\t\tvalidatedInput.seo\n\t\t) {\n\t\t\tawait tx.productTranslation.upsert({\n\t\t\t\twhere: {\n\t\t\t\t\tproductId_localeId: {\n\t\t\t\t\t\tproductId: validatedInput.id,\n\t\t\t\t\t\tlocaleId: \"en\",\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tupdate: {\n\t\t\t\t\t...(validatedInput.name && { name: validatedInput.name }),\n\t\t\t\t\t...(validatedInput.description !== undefined && {\n\t\t\t\t\t\tdescription: validatedInput.description,\n\t\t\t\t\t}),\n\t\t\t\t\t...(validatedInput.seo?.metaTitle !== undefined && {\n\t\t\t\t\t\tmetaTitle: validatedInput.seo.metaTitle,\n\t\t\t\t\t}),\n\t\t\t\t\t...(validatedInput.seo?.metaDescription !== undefined && {\n\t\t\t\t\t\tmetaDescription: validatedInput.seo.metaDescription,\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t\tcreate: {\n\t\t\t\t\tproductId: validatedInput.id,\n\t\t\t\t\tlocaleId: \"en\",\n\t\t\t\t\tname: validatedInput.name ?? \"Untitled\",\n\t\t\t\t\tdescription: validatedInput.description,\n\t\t\t\t\tmetaTitle: validatedInput.seo?.metaTitle,\n\t\t\t\t\tmetaDescription: validatedInput.seo?.metaDescription,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\t// Update media (replace all)\n\t\tif (validatedInput.media) {\n\t\t\tawait tx.productMedia.deleteMany({\n\t\t\t\twhere: { productId: validatedInput.id },\n\t\t\t});\n\n\t\t\tif (validatedInput.media.length > 0) {\n\t\t\t\tawait tx.productMedia.createMany({\n\t\t\t\t\tdata: validatedInput.media.map((m, index) => ({\n\t\t\t\t\t\tproductId: validatedInput.id,\n\t\t\t\t\t\turl: m.url,\n\t\t\t\t\t\tmediaType: m.mediaType,\n\t\t\t\t\t\taltText: m.altText,\n\t\t\t\t\t\torder: m.order ?? index,\n\t\t\t\t\t})),\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t// Update variants (replace all)\n\t\tif (validatedInput.variants) {\n\t\t\t// Delete existing variants and their meta\n\t\t\tconst existingVariants = await tx.productVariant.findMany({\n\t\t\t\twhere: { productId: validatedInput.id },\n\t\t\t\tselect: { id: true },\n\t\t\t});\n\n\t\t\tfor (const v of existingVariants) {\n\t\t\t\tawait tx.variantOptionMeta.deleteMany({ where: { variantId: v.id } });\n\t\t\t}\n\n\t\t\tawait tx.productVariant.deleteMany({\n\t\t\t\twhere: { productId: validatedInput.id },\n\t\t\t});\n\n\t\t\t// Create new variants\n\t\t\tfor (const variant of validatedInput.variants) {\n\t\t\t\tconst createdVariant = await tx.productVariant.create({\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tproductId: validatedInput.id,\n\t\t\t\t\t\tsku: variant.sku,\n\t\t\t\t\t\tprice: variant.price,\n\t\t\t\t\t\tpriceAdjustment: variant.priceAdjustment ?? 0,\n\t\t\t\t\t\tstock: variant.stock,\n\t\t\t\t\t\timageUrl: variant.imageUrl,\n\t\t\t\t\t\toptions: variant.options,\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tif (variant.optionMeta && variant.optionMeta.length > 0) {\n\t\t\t\t\tawait tx.variantOptionMeta.createMany({\n\t\t\t\t\t\tdata: variant.optionMeta.map((meta) => ({\n\t\t\t\t\t\t\tvariantId: createdVariant.id,\n\t\t\t\t\t\t\toptionName: meta.optionName,\n\t\t\t\t\t\t\thexColor: meta.hexColor,\n\t\t\t\t\t\t})),\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Update shipping info\n\t\tif (validatedInput.shippingInfo) {\n\t\t\tawait tx.productShippingInfo.upsert({\n\t\t\t\twhere: { productId: validatedInput.id },\n\t\t\t\tupdate: {\n\t\t\t\t\tpackageType: validatedInput.shippingInfo.packageType,\n\t\t\t\t\tpackagingWeightKg: validatedInput.shippingInfo.weight,\n\t\t\t\t\tpackagingLengthCm: validatedInput.shippingInfo.packageLength,\n\t\t\t\t\tpackagingWidthCm: validatedInput.shippingInfo.packageWidth,\n\t\t\t\t\tpackagingHeightCm: validatedInput.shippingInfo.packageHeight,\n\t\t\t\t\tproductWeightKg: validatedInput.shippingInfo.productWeight,\n\t\t\t\t\tproductLengthCm: validatedInput.shippingInfo.productLength,\n\t\t\t\t\tproductWidthCm: validatedInput.shippingInfo.productWidth,\n\t\t\t\t\tproductHeightCm: validatedInput.shippingInfo.productHeight,\n\t\t\t\t},\n\t\t\t\tcreate: {\n\t\t\t\t\tproductId: validatedInput.id,\n\t\t\t\t\tpackageType: validatedInput.shippingInfo.packageType,\n\t\t\t\t\tpackagingWeightKg: validatedInput.shippingInfo.weight,\n\t\t\t\t\tpackagingLengthCm: validatedInput.shippingInfo.packageLength,\n\t\t\t\t\tpackagingWidthCm: validatedInput.shippingInfo.packageWidth,\n\t\t\t\t\tpackagingHeightCm: validatedInput.shippingInfo.packageHeight,\n\t\t\t\t\tproductWeightKg: validatedInput.shippingInfo.productWeight,\n\t\t\t\t\tproductLengthCm: validatedInput.shippingInfo.productLength,\n\t\t\t\t\tproductWidthCm: validatedInput.shippingInfo.productWidth,\n\t\t\t\t\tproductHeightCm: validatedInput.shippingInfo.productHeight,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\t// Update collection links\n\t\tif (validatedInput.collectionIds) {\n\t\t\tawait tx.collectionProduct.deleteMany({\n\t\t\t\twhere: { productId: validatedInput.id },\n\t\t\t});\n\n\t\t\tif (validatedInput.collectionIds.length > 0) {\n\t\t\t\tawait tx.collectionProduct.createMany({\n\t\t\t\t\tdata: validatedInput.collectionIds.map((collectionId) => ({\n\t\t\t\t\t\tproductId: validatedInput.id,\n\t\t\t\t\t\tcollectionId,\n\t\t\t\t\t})),\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t});\n\n\trevalidatePath(\"/admin/products\");\n\trevalidatePath(`/admin/products/${validatedInput.id}/edit`);\n\n\treturn { success: true };\n}\n\n// Soft delete product (move to trash)\nexport async function deleteProduct(productId: string) {\n\tconst { tenantId } = await requireStoreAccess();\n\n\t// Verify product belongs to tenant\n\tconst product = await db.product.findFirst({\n\t\twhere: { id: productId, tenantId },\n\t});\n\tif (!product) {\n\t\tthrow new Error(\"Product not found\");\n\t}\n\n\tawait db.product.update({\n\t\twhere: { id: productId },\n\t\tdata: { deletedAt: new Date() },\n\t});\n\n\trevalidatePath(\"/admin/products\");\n\trevalidatePath(\"/admin/products/trash\");\n\n\treturn { success: true };\n}\n\n// Restore product from trash\nexport async function restoreProduct(productId: string) {\n\tconst { tenantId } = await requireStoreAccess();\n\n\t// Verify product belongs to tenant\n\tconst product = await db.product.findFirst({\n\t\twhere: { id: productId, tenantId },\n\t});\n\tif (!product) {\n\t\tthrow new Error(\"Product not found\");\n\t}\n\n\tawait db.product.update({\n\t\twhere: { id: productId },\n\t\tdata: { deletedAt: null },\n\t});\n\n\trevalidatePath(\"/admin/products\");\n\trevalidatePath(\"/admin/products/trash\");\n\n\treturn { success: true };\n}\n\n// Bulk restore products\nexport async function restoreProducts(productIds: string[]) {\n\tconst { tenantId } = await requireStoreAccess();\n\n\tawait db.product.updateMany({\n\t\twhere: { id: { in: productIds }, tenantId },\n\t\tdata: { deletedAt: null },\n\t});\n\n\trevalidatePath(\"/admin/products\");\n\trevalidatePath(\"/admin/products/trash\");\n\n\treturn { success: true };\n}\n\n// Permanently delete product\nexport async function permanentlyDeleteProduct(productId: string) {\n\tconst { tenantId } = await requireStoreAccess();\n\n\t// Verify product belongs to tenant and get media for cleanup\n\tconst product = await db.product.findFirst({\n\t\twhere: { id: productId, tenantId },\n\t\tinclude: {\n\t\t\tmedia: {\n\t\t\t\tselect: { url: true },\n\t\t\t},\n\t\t},\n\t});\n\tif (!product) {\n\t\tthrow new Error(\"Product not found\");\n\t}\n\n\t// Collect media URLs for cleanup\n\tconst mediaUrls = product.media.map((m) => m.url);\n\n\tawait db.$transaction(async (tx) => {\n\t\t// Delete related data\n\t\tconst variants = await tx.productVariant.findMany({\n\t\t\twhere: { productId },\n\t\t\tselect: { id: true },\n\t\t});\n\n\t\tfor (const v of variants) {\n\t\t\tawait tx.variantOptionMeta.deleteMany({ where: { variantId: v.id } });\n\t\t}\n\n\t\tawait tx.productVariant.deleteMany({ where: { productId } });\n\t\tawait tx.productMedia.deleteMany({ where: { productId } });\n\t\tawait tx.productShippingInfo.deleteMany({ where: { productId } });\n\t\tawait tx.productTranslation.deleteMany({ where: { productId } });\n\t\tawait tx.collectionProduct.deleteMany({ where: { productId } });\n\n\t\t// Finally delete the product\n\t\tawait tx.product.delete({ where: { id: productId } });\n\t});\n\n\t// Cleanup media files from R2 (after DB deletion)\n\tif (mediaUrls.length > 0) {\n\t\tawait cleanupProductMedia(mediaUrls, tenantId);\n\t}\n\n\trevalidatePath(\"/admin/products/trash\");\n\n\treturn { success: true };\n}\n\n// Bulk permanently delete products\nexport async function permanentlyDeleteProducts(productIds: string[]) {\n\tawait requireStoreAccess(); // Verify access, individual deletes check ownership\n\n\tfor (const productId of productIds) {\n\t\tawait permanentlyDeleteProduct(productId);\n\t}\n\n\treturn { success: true };\n}\n\n// Get trashed products\nexport async function getTrashedProducts() {\n\tconst { tenantId } = await requireStoreAccess();\n\n\tconst products = await db.product.findMany({\n\t\twhere: {\n\t\t\ttenantId,\n\t\t\tdeletedAt: { not: null },\n\t\t},\n\t\torderBy: { deletedAt: \"desc\" },\n\t\tinclude: {\n\t\t\ttranslations: {\n\t\t\t\twhere: { localeId: \"en\" },\n\t\t\t\ttake: 1,\n\t\t\t},\n\t\t\tmedia: {\n\t\t\t\torderBy: { order: \"asc\" },\n\t\t\t\ttake: 1,\n\t\t\t},\n\t\t},\n\t});\n\n\treturn products.map((p) => ({\n\t\tid: p.id,\n\t\tname: p.translations[0]?.name ?? \"Untitled\",\n\t\tsku: p.sku,\n\t\tprice: p.price,\n\t\tdeletedAt: p.deletedAt ?? new Date(),\n\t\timageUrl: p.media[0]?.url ?? null,\n\t}));\n}\n\n// Clean up old trashed products (called by cron job)\nexport async function cleanupTrashedProducts(retentionDays = 30) {\n\t// This function should be called by a cron job\n\t// Don't require admin - it runs as a system task\n\n\tconst cutoffDate = new Date();\n\tcutoffDate.setDate(cutoffDate.getDate() - retentionDays);\n\n\tconst oldProducts = await db.product.findMany({\n\t\twhere: {\n\t\t\tdeletedAt: { lte: cutoffDate },\n\t\t},\n\t\tselect: { id: true },\n\t});\n\n\tfor (const product of oldProducts) {\n\t\tawait permanentlyDeleteProduct(product.id);\n\t}\n\n\treturn { deleted: oldProducts.length };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1998, "column": 0}, "map": {"version":3,"sources":["file:///Users/bobkata/Projects/boostcart/apps/platform/.next-internal/server/app/%28internal%29/admin/products/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {getUserStores as '003bfcd7ac293af20dc22123ec44e81263e2c95347'} from 'ACTIONS_MODULE0'\nexport {userHasStore as '00b865bde8853c0b2200356e8a44aabbfda99ded8f'} from 'ACTIONS_MODULE0'\nexport {getCurrentTenant as '00f61908051b9076d3d4981917b5b0f4b9a64a3f03'} from 'ACTIONS_MODULE0'\nexport {createStore as '40177cd97a285945b21e6d3751ddbdc14238608821'} from 'ACTIONS_MODULE0'\nexport {checkSlugAvailability as '40ece7c8b327f75aed046925634f22b2bd96f4eb54'} from 'ACTIONS_MODULE0'\nexport {getCurrentTenant as '00f61908051b9076d3d4981917b5b0f4b9a64a3f03'} from 'ACTIONS_MODULE0'\nexport {deleteProduct as '405d7bf5b1e1ff67b41050f9c6b3b647526820a0d9'} from 'ACTIONS_MODULE1'\nexport {getProducts as '400bf41a515368060d000c008be7121072342d4535'} from 'ACTIONS_MODULE1'\n"],"names":[],"mappings":";AAAA;AAMA"}}]
}